{"version":3,"file":"timelineEngine.js","sources":["uts/timelineEngine.uts"],"sourcesContent":["// 核心类型定义（使用type替代interface避免Android解析问题）\ntype TimelineParams = {\n  duration: number\n  width: number\n  density: number\n  events: EventMarker[]\n  visibleRange: { start: number; end: number }\n}\n\ntype EventMarker = {\n  timestamp: number\n  type: 'alarm' | 'motion' | 'custom'\n  level: number\n}\n\ntype TimeMark = {\n  timestamp: number\n  position: number\n  label: string\n  hasEvent: boolean\n}\n\n// 主计算函数（Android/iOS双平台兼容）\nexport function calculateTimeline(params: TimelineParams): TimeMark[] {\n  // 参数安全校验\n  if (!params || params.duration <= 0 || params.width <= 0) {\n    console.error(\"Invalid timeline parameters\")\n    return []\n  }\n\n  const results: TimeMark[] = []\n  const pxPerSecond = params.width / params.duration\n  const safeDensity = Math.max(1, Math.min(60, params.density))\n\n  // 生成时间标记（仅渲染可见区域）\n  for (let minute = 0; minute <= params.duration / 60; minute += safeDensity) {\n    const timestamp = minute * 60\n    if (timestamp < params.visibleRange.start || timestamp > params.visibleRange.end) continue\n\n    results.push({\n      timestamp: timestamp,\n      position: androidSafePositionCalc(timestamp * pxPerSecond), // Android特殊处理\n      label: formatTimeLabel(minute),\n      hasEvent: checkEvent(timestamp, params.events)\n    })\n  }\n\n  return results\n}\n\n// Android浮点精度处理\nfunction androidSafePositionCalc(pos: number): number {\n  // #ifdef APP-ANDROID\n  return Math.round(pos * 100) / 100\n  // #endif\n  // #ifndef APP-ANDROID\n  return pos\n  // #endif\n}\n\n// 事件检测\nfunction checkEvent(timestamp: number, events: EventMarker[]): boolean {\n  if (!events || events.length === 0) return false\n  return events.some(e => Math.abs(e.timestamp - timestamp) < 30)\n}\n\n// 时间格式化\nfunction formatTimeLabel(totalMinutes: number): string {\n  const hours = Math.floor(totalMinutes / 60)\n  const mins = totalMinutes % 60\n  return `${padZero(hours)}:${padZero(mins)}`\n}\n\nfunction padZero(num: number): string {\n  return num < 10 ? `0${num}` : num.toString()\n}"],"names":["uni"],"mappings":";;MACK,uBAAc,IAAA,QAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;MAQd,oBAAW,IAAA,QAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;MAMX,iBAAQ,IAAA,QAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;AAQP,SAAU,kBAAkB,QAAsB;AAEtD,MAAI,CAAC,UAAU,OAAO,YAAY,KAAK,OAAO,SAAS,GAAG;AACxDA,kBAAAA,MAAA,MAAA,SAAA,gCAAc,6BAA6B;AAC3C,WAAO;EACR;AAED,QAAM,UAAsB,CAAA;AAC5B,QAAM,cAAc,OAAO,QAAQ,OAAO;AAC1C,QAAM,cAAc,KAAK,IAAI,GAAG,KAAK,IAAI,IAAI,OAAO,OAAO,CAAC;AAG5D,WAAS,SAAS,GAAG,UAAU,OAAO,WAAW,IAAI,UAAU,aAAa;AAC1E,UAAM,YAAY,SAAS;AAC3B,QAAI,YAAY,OAAO,aAAa,SAAS,YAAY,OAAO,aAAa;AAAK;AAElF,YAAQ,KAAK,IAAA,SAAA;AAAA,MACX;AAAA,MACA,UAAU,wBAAwB,YAAY,WAAW;AAAA,MACzD,OAAO,gBAAgB,MAAM;AAAA,MAC7B,UAAU,WAAW,WAAW,OAAO,MAAM;AAAA,IAC9C,CAAA,CAAA;AAAA,EACF;AAED,SAAO;AACT;AAGA,SAAS,wBAAwB,KAAW;AAK1C,SAAO;AAET;AAGA,SAAS,WAAW,WAAmB,QAAqB;AAC1D,MAAI,CAAC,UAAU,OAAO,WAAW;AAAG,WAAO;AAC3C,SAAO,OAAO,KAAK,OAAK;AAAA,WAAA,KAAK,IAAI,EAAE,YAAY,SAAS,IAAI;AAAA,EAAE,CAAA;AAChE;AAGA,SAAS,gBAAgB,cAAoB;AAC3C,QAAM,QAAQ,KAAK,MAAM,eAAe,EAAE;AAC1C,QAAM,OAAO,eAAe;AAC5B,SAAO,GAAG,QAAQ,KAAK,CAAC,IAAI,QAAQ,IAAI,CAAC;AAC3C;AAEA,SAAS,QAAQ,KAAW;AAC1B,SAAO,MAAM,KAAK,IAAI,GAAG,KAAK,IAAI;AACpC;;"}