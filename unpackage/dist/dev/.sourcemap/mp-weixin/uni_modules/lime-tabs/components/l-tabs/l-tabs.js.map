{"version":3,"file":"l-tabs.js","sources":["uni_modules/lime-tabs/components/l-tabs/l-tabs.uvue","/Users/xyhc/Documents/veepai_uniappx/uni_modules/lime-tabs/components/l-tabs/l-tabs.uvue?type=component"],"sourcesContent":["<template>\r\n\t<view class=\"l-tabs\">\r\n\t\t<view class=\"l-tabs__wrap\" :style=\"[styles, lStyle]\">\r\n\t\t\t<slot name=\"left\"></slot>\r\n\t\t\t<scroll-view \r\n\t\t\t\tclass=\"l-tabs__scroll\" \r\n\t\t\t\t:class=\"{'l-tabs__scroll--split': split}\" \r\n\t\t\t\tref=\"scrollRef\"\r\n\t\t\t\t:scroll-left=\"scrollLeft\" \r\n\t\t\t\tdirection=\"horizontal\" \r\n\t\t\t\t:scroll-x=\"true\" \r\n\t\t\t\t:scroll-with-animation=\"true\"\r\n\t\t\t\t:show-scrollbar=\"false\" \r\n\t\t\t\t:enhanced=\"true\" \r\n\t\t\t\t@scroll=\"onScroll\">\r\n\r\n\t\t\t\t<view ref=\"navRef\" class=\"l-tabs__nav\">\r\n\r\n\t\t\t\t\t<view class=\"l-tabs__item\" v-for=\"(item, index) in tabs\" :key=\"index\" :style=\"[itemStyle]\" :class=\"{\r\n\t\t\t\t\t\t\t'l-tabs__item--active': index == currentIndex,\r\n\t\t\t\t\t\t\t'l-tabs__item--evenly': spaceEvenly, \r\n\t\t\t\t\t\t\t'l-tabs__item--disabled': item.disabled}\" @click=\"onClick(index, item)\">\r\n\t\t\t\t\t\t<slot name=\"label\" :item=\"item\" :active=\"index == currentIndex\" :disabled=\"item.disabled\">\r\n\t\t\t\t\t\t\t<l-badge v-if=\"item.dot == true || item.badge != null\" :dot=\"item.dot\" :offset=\"item.offset\"\r\n\t\t\t\t\t\t\t\t:content=\"item.badge\">\r\n\t\t\t\t\t\t\t\t<text :style=\"[\r\n\t\t\t\t\t\t\t\t\t\ttextStyles,\r\n\t\t\t\t\t\t\t\t\t\t!item.disabled && color != null && index != currentIndex ? ('color:' + color) : '',\r\n\t\t\t\t\t\t\t\t\t\t!item.disabled && activeColor != null && index == currentIndex ? 'color:' + activeColor : '',\r\n\t\t\t\t\t\t\t\t\t]\" class=\"l-tabs__item-text\" :class=\"[\r\n\t\t\t\t\t\t\t\t\t\t'l-tabs__item-text--' + size,\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t'l-tabs__item-text--disabled': item.disabled,\r\n\t\t\t\t\t\t\t\t\t\t\t'l-tabs__item-text--active': index == currentIndex\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t]\">{{item.label}}</text>\r\n\t\t\t\t\t\t\t</l-badge>\r\n\t\t\t\t\t\t\t<text v-else :style=\"[\r\n\t\t\t\t\t\t\t\t\ttextStyles,\r\n\t\t\t\t\t\t\t\t\t!item.disabled && color != null && index != currentIndex ? ('color:' + color) : '',\r\n\t\t\t\t\t\t\t\t\t!item.disabled && activeColor != null && index == currentIndex ? 'color:' + activeColor : '',\r\n\t\t\t\t\t\t\t\t]\" class=\"l-tabs__item-text\" :class=\"[\r\n\t\t\t\t\t\t\t\t\t'l-tabs__item-text--' + size,\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t'l-tabs__item-text--disabled': item.disabled,\r\n\t\t\t\t\t\t\t\t\t\t'l-tabs__item-text--active': index == currentIndex\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t]\">{{item.label}}</text>\r\n\t\t\t\t\t\t</slot>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view ref=\"trackRef\" :style=\"[trackStyle]\" class=\"l-tabs__track\"></view>\r\n\r\n\t\t\t\t</view>\r\n\r\n\t\t\t</scroll-view>\r\n\t\t\t<slot name=\"right\"></slot>\r\n\t\t</view>\r\n\t\t<view class=\"l-tabs__content\" @touchstart=\"onTouchStart\" @touchmove=\"onTouchMove\" @touchend=\"onTouchEnd\"\r\n\t\t\t@touchcancel=\"onTouchEnd\" :class=\"{'l-tabs__content--animated': animated}\" v-if=\"$slots['default'] != null\">\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\t\t<view class=\"l-tabs__content-inner\" :style=\"[innerStyle, {width: tabs.length * 100 + '%'}]\" ref=\"innerRef\">\r\n\t\t\t\t<slot></slot>\r\n\t\t\t</view>\r\n\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script lang=\"uts\" setup>\r\n\t/**\r\n\t * Tabs 标签页组件\r\n\t * @description 用于内容分类展示和切换，支持多种样式和交互效果\r\n\t * <br>插件类型：LTabsComponentPublicInstance \r\n\t * @tutorial https://ext.dcloud.net.cn/plugin?name=lime-tabs\r\n\t * \r\n\t * @property {TabPanel[]} list 选项卡配置数组\r\n\t * @property {boolean} ellipsis 是否省略超长文本（默认：true）\r\n\t * @property {boolean} animated 是否启用切换动画（默认：false）\r\n\t * @property {number} duration 动画时长（ms，默认：300）\r\n\t * @property {boolean} showLine 显示底部激活线条（默认：true）\r\n\t * @property {'medium' | 'large'} size 组件尺寸（默认：\"medium\"）\r\n\t * @value medium\r\n\t * @value large\r\n\t * @property {boolean} spaceEvenly 均分选项卡宽度（默认：false）\r\n\t * @property {boolean} swipeable 支持滑动切换（默认：true）\r\n\t * @property {number} value 当前激活选项卡索引（支持v-model）\r\n\t * @property {string} color 默认文字颜色（默认：\"#333\"）\r\n\t * @property {string} activeColor 激活状态颜色（默认：主题色）\r\n\t * @property {string} lineColor 激活线条颜色（默认：跟随activeColor）\r\n\t * @property {string} lineWidth 激活线条宽度（默认：\"20px\"）\r\n\t * @property {string} lineHeight 激活线条高度（默认：\"3px\"）\r\n\t * @property {string} bgColor 背景颜色\r\n\t * @property {string} fontSize 文字大小（支持CSS单位）\r\n\t * @property {string} padding 内边距（支持CSS简写）\r\n\t * @property {boolean} split 显示分隔线（默认：false）\r\n\t * @property {boolean} visible 是否显示组件（默认：true）\r\n\t * @property {number} swiperProgress 与swiper联动，传入[-1, 1] 范围的滚动进度\r\n\t * @property {boolean} syncSwiper 是否启用与swiper的同步联动\r\n\t * @event {Function} change 选项卡切换时触发（返回激活索引）\r\n\t * @event {Function} click 点击时触发（返回激活索引）\r\n\t */\r\n\r\n\timport { TabsProps, TabPanel } from './type';\r\n\timport { TabPanelProps } from '../l-tab-panel/type';\r\n\timport { calcScrollOffset, ease } from './utils';\r\n\timport { clamp } from '@/uni_modules/lime-shared/clamp';\r\n\t// import { getRect } from '@/uni_modules/lime-shared/getRect';\r\n\timport { getRect, getAllRect } from '@/uni_modules/lime-shared/getRect'\r\n\timport { useTouch } from './touch'\r\n\tconst emits = defineEmits(['change', 'click'])\r\n\t// const slots = defineSlots<{\r\n\t// \tlabel : {\r\n\t// \t\titem : TabPanel,\r\n\t// \t\tactive : boolean,\r\n\t// \t\tdisabled : boolean,\r\n\t// \t}\r\n\t// }>()\r\n\r\n\tconst slots = defineSlots<{\r\n\t\tlabel(props : { item : TabPanel, active : boolean, disabled : boolean }) : any,\r\n\t\tdefault(props : {}) : any,\r\n\t\tleft(props : {}) : any,\r\n\t\tright(props : {}) : any,\r\n\t}>()\r\n\r\n\tconst props = withDefaults(defineProps<TabsProps>(), {\r\n\t\tshowLine: true,\r\n\t\tvisible: false,\r\n\t\tellipsis: false,\r\n\t\tsize: 'medium',\r\n\t\tspaceEvenly: true,\r\n\t\tswipeable: false,\r\n\t\tduration: 0.3,\r\n\t\tanimated: false,\r\n\t\tsplit: true,\r\n\t\tswiperProgress: 0,\r\n\t\tsyncSwiper: false\r\n\t})\r\n\r\n\tconst children = ref<LTabPanelComponentPublicInstance[]>([])\r\n\tconst scrollLeft = ref(0);\r\n\tconst lastLeft = ref(0);\r\n\r\n\r\n\tconst context = getCurrentInstance().proxy!;\r\n\tconst trackDistance = ref(0)\r\n\tconst innerStyle = reactive({\r\n\t\twidth: '',\r\n\t\t'transition-duration': ``,\r\n\t\t'transform': ``,\r\n\t})\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\tconst modelValue = defineModel({ type: Number })\r\n\tconst currentValue = computed({\r\n\t\tset(value : number) {\r\n\t\t\tmodelValue.value = value;\r\n\t\t\temits('change', value)\r\n\t\t},\r\n\t\tget() : number {\r\n\t\t\treturn props.value ?? modelValue.value\r\n\t\t}\r\n\t} as WritableComputedOptions<number>);\r\n\r\n\tconst styles = computed(() : Map<string, any> => {\r\n\t\tconst style = new Map<string, any>();\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\tif (props.bgColor != null) {\r\n\t\t\tstyle.set('--l-tab-nav-bg-color', props.bgColor!)\r\n\t\t}\r\n\t\tif (!['medium', 'large'].includes(props.size)) {\r\n\t\t\tstyle.set('--l-tab-item-height', props.size)\r\n\t\t}\r\n\t\tif (props.padding != null) {\r\n\t\t\tstyle.set('--l-tab-item-padding', props.padding!)\r\n\t\t}\r\n\t\tif (props.fontSize != null) {\r\n\t\t\tstyle.set('--l-tab-font-size', props.fontSize!)\r\n\t\t}\r\n\r\n\t\treturn style\r\n\t})\r\n\tconst trackStyle = computed(() : Map<string, any> => {\r\n\t\tconst style = new Map<string, any>([\r\n\r\n\t\t\t['-webkit-transform', `translateX(${trackDistance.value}px)`],\r\n\t\t\t['transform', `translateX(${trackDistance.value}px)`],\r\n\r\n\t\t]);\r\n\r\n\t\tif (props.lineColor != null) {\r\n\t\t\tstyle.set('background', props.lineColor!)\r\n\t\t}\r\n\t\tif (props.lineWidth != null) {\r\n\t\t\tstyle.set('width', props.lineWidth!)\r\n\t\t}\r\n\t\tif (props.lineHeight != null) {\r\n\t\t\tstyle.set('height', props.lineHeight!)\r\n\t\t}\r\n\t\treturn style\r\n\t})\r\n\tconst itemStyle = computed(() : Map<string, any> => {\r\n\t\tconst style = new Map<string, any>()\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\treturn style\r\n\t})\r\n\tconst textStyles = computed(() : Map<string, any> => {\r\n\t\tconst style = new Map<string, any>()\r\n\r\n\r\n\r\n\r\n\r\n\t\treturn style\r\n\t})\r\n\r\n\tconst tabs = computed(() : TabPanel[] => {\r\n\t\tif (props.list != null && props.list!.length > 0) {\r\n\t\t\treturn props.list!.map((item) : TabPanel => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tbadge: item.get('badge'),\r\n\t\t\t\t\tdot: item.getBoolean('dot') ?? false,\r\n\t\t\t\t\tdisabled: item.getBoolean('disabled') ?? false,\r\n\t\t\t\t\tlabel: item.getString('label'),\r\n\t\t\t\t\toffset: item.getArray('offset') as any[] | null,\r\n\t\t\t\t\tvalue: item.getNumber('value'),\r\n\t\t\t\t\tnode: item\r\n\t\t\t\t} as TabPanel\r\n\t\t\t})\r\n\t\t}\r\n\t\treturn children.value.map((item) : TabPanel => {\r\n\r\n\t\t\t// 安卓端数组属性存在BUG 死循环\r\n\r\n\r\n\r\n\r\n\t\t\tconst offset = item.offset ?? []\r\n\r\n\r\n\r\n\t\t\treturn {\r\n\t\t\t\tbadge: item.badge,\r\n\t\t\t\tdot: item.dot ?? false,\r\n\t\t\t\tdisabled: item.disabled ?? false,\r\n\t\t\t\tlabel: item.label,\r\n\t\t\t\toffset: offset,\r\n\t\t\t\tvalue: item.value,\r\n\t\t\t\tnode: {\r\n\t\t\t\t\tbadge: item.badge,\r\n\t\t\t\t\tdot: item.dot ?? false,\r\n\t\t\t\t\tdisabled: item.disabled ?? false,\r\n\t\t\t\t\tlabel: item.label,\r\n\t\t\t\t\toffset: offset,\r\n\t\t\t\t\tvalue: item.value,\r\n\t\t\t\t}\r\n\t\t\t} as TabPanel\r\n\t\t})\r\n\t})\r\n\r\n\tconst currentIndex = computed(() : number => {\r\n\t\tconst index = tabs.value.findIndex((child, index) : boolean => (child.value ?? index) == currentValue.value)\r\n\t\treturn index > -1 ? index : 0;\r\n\t})\r\n\r\n\tconst scrollRef = ref<UniScrollViewElement | null>(null)\r\n\tconst trackRef = ref<UniElement | null>(null)\r\n\tconst navRef = ref<UniElement | null>(null)\r\n\tconst innerRef = ref<UniElement | null>(null)\r\n\r\n\tconst tabRects = ref<DOMRect[]>([])  // 存储每个tab的尺寸位置\r\n\tconst containerWidth = ref(0)        // 容器宽度\r\n\tconst trackLineWidth = ref(0)\r\n\tconst isInteracting = ref(false)     // 是否正在交互\r\n\tlet timer = 0\r\n\t\r\n\r\n\tconst measureTabs = () : Promise<void> => {\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\t// nextTick(() => {\r\n\t\t\t\tif(tabRects.value.length > 0 && tabRects.value[0].width > 0) {\r\n\t\t\t\t\tresolve()\r\n\t\t\t\t}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\t\t\tPromise.all([\r\n\t\t\t\t\tgetRect(`.l-tabs__scroll`, context),\r\n\t\t\t\t\tgetRect(`.l-tabs__track`, context),\r\n\t\t\t\t\tgetAllRect(`.l-tabs__item`, context)\r\n\t\t\t\t]).then(([scrollRect, trackRect, tabsRects]) => {\r\n\t\t\t\t\tcontainerWidth.value = scrollRect.width\r\n\t\t\t\t\ttabRects.value = tabsRects\r\n\t\t\t\t\ttrackLineWidth.value = trackRect.width\r\n\t\t\t\t\tresolve()\r\n\t\t\t\t})\r\n\r\n\t\t\t\t\r\n\t\t\t})\r\n\t\t// })\r\n\r\n\t}\r\n\r\n\tconst moveToActiveTab = () => {\r\n\t\tmeasureTabs().then(() => {\r\n\t\t\tconst index = currentIndex.value\r\n\t\t\tif (tabRects.value.length <= index) return\r\n\t\t\tconst tabRect = tabRects.value[index]\r\n\r\n\t\t\tlet count = 0;\r\n\t\t\tlet distance = 0;\r\n\t\t\tlet totalSize = 0;\r\n\t\t\t\r\n\t\t\ttabRects.value.forEach((item : DOMRect) => {\r\n\t\t\t\tif (count < index) {\r\n\t\t\t\t\tdistance += item.width;\r\n\t\t\t\t\tcount += 1;\r\n\t\t\t\t}\r\n\t\t\t\ttotalSize += item.width;\r\n\t\t\t});\r\n\t\t\tif (totalSize == 0) return\r\n\r\n\r\n\t\t\t// 计算track最终位置\r\n\t\t\tdistance += (tabRect.width - trackLineWidth.value) / 2;\r\n\r\n\r\n\r\n\r\n\t\t\ttrackDistance.value = distance\r\n\r\n\r\n\r\n\t\t\t// 计算scroll-view需要滚动的距离\r\n\t\t\tconst scrollOffset = calcScrollOffset(\r\n\t\t\t\tcontainerWidth.value,\r\n\t\t\t\ttabRect.left,\r\n\t\t\t\ttabRect.width,\r\n\t\t\t\tlastLeft.value\r\n\t\t\t)\r\n\r\n\t\t\tconst maxOffset = totalSize - containerWidth.value;\r\n\r\n\t\t\tscrollLeft.value = clamp(scrollOffset, 0, maxOffset)\r\n\t\t\t// isInteracting.value = false\r\n\t\t})\r\n\t}\r\n\tconst updateInnerStyle = (offset : number) => {\r\n\t\tnextTick(() => {\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\t\t// const width = innerRef.value!.parentElement?.offsetWidth ?? 0;\r\n\t\t\tPromise.all(\r\n\t\t\t\t[\r\n\t\t\t\t\tgetRect('.l-tabs__content', context),\r\n\t\t\t\t\tgetRect('.l-tabs__content-inner', context)\r\n\t\t\t\t]).then(([parent, inner]) => {\r\n\t\t\t\t\tconst left = -parent.width * currentIndex.value + offset;\r\n\t\t\t\t\tif (offset != 0) {\r\n\t\t\t\t\t\tinnerStyle.transform = `translateX(${left}px)`\r\n\t\t\t\t\t\tinnerStyle['transition-duration'] = `0s`\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (props.animated) {\r\n\t\t\t\t\t\t\tinnerStyle['transition-duration'] = offset != 0 || !props.animated ? '0s' : `${props.duration}s`\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tinnerStyle.transform = `translateX(${left}px)`\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(err => {\r\n\r\n\t\t\t\t})\r\n\r\n\r\n\t\t})\r\n\t}\r\n\tconst onScroll = (e : UniScrollEvent) => {\r\n\t\tlastLeft.value = e.detail.scrollLeft;\r\n\t}\r\n\tconst updateDuration = (duration: number) => {\r\n\r\n\r\n\r\n\r\n\t\tinnerStyle['transition-duration'] =  `${duration}s`\r\n\r\n\t}\r\n\tconst onClick = (index : number, item : TabPanel) => {\r\n\t\tisInteracting.value = true\r\n\t\tconst { value = index, disabled, label } = item;\r\n\t\tif (disabled || currentValue.value == value) return\r\n\t\tcurrentValue.value = value;\r\n\t\temits('click', value)\r\n\t\tupdateDuration(0.3)\r\n\t\tnextTick(()=> {\r\n\t\t\tmoveToActiveTab()\r\n\t\t})\r\n\t\t\r\n\t\tclearTimeout(timer)\r\n\t\ttimer = setTimeout(()=>{\r\n\t\t\tisInteracting.value = false\r\n\t\t},500)\r\n\t\t\r\n\t}\r\n\r\n\tconst getAvailableTabIndex = (deltaX : number) : number => {\r\n\t\tconst step = deltaX > 0 ? -1 : 1;\r\n\t\tconst len = tabs.value.length;\r\n\t\tfor (let i = step; currentIndex.value + step >= 0 && currentIndex.value + step < len; i += step) {\r\n\t\t\tconst newIndex = currentIndex.value + i;\r\n\r\n\t\t\tif (newIndex >= 0 && newIndex < len && tabs.value.length > newIndex && !tabs.value[newIndex].disabled) {\r\n\t\t\t\treturn newIndex;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t}\r\n\tconst touch = useTouch();\r\n\tconst onTouchStart = (event : UniTouchEvent) => {\r\n\t\t isInteracting.value = true\r\n\t\tif (!props.swipeable) return;\r\n\t\ttouch.start(event);\r\n\t\tupdateDuration(0.3)\r\n\t}\r\n\r\n\tconst onTouchMove = (event : UniTouchEvent) => {\r\n\t\tif (!props.swipeable) return;\r\n\t\ttouch.move(event);\r\n\t\tconst { direction, deltaX, startX } = touch\r\n\t\tif (direction.value != 'horizontal') return\r\n\t\tif (!props.animated) return\r\n\t\tconst isAtFirstTab = currentIndex.value == 0;\r\n\t\tconst isAtLastTab = currentIndex.value == tabs.value.length - 1;\r\n\r\n\t\tif ((isAtFirstTab && deltaX.value > 0) || (isAtLastTab && deltaX.value < 0)) {\r\n\t\t\tconst base = isAtFirstTab ? 1 : -1;\r\n\t\t\tconst adjustedDelta = ease(deltaX.value, base);\r\n\t\t\tupdateInnerStyle(adjustedDelta);\r\n\t\t} else {\r\n\t\t\tupdateInnerStyle(deltaX.value);\r\n\t\t}\r\n\t}\r\n\r\n\tconst onTouchEnd = () => {\r\n\t\tisInteracting.value = false\r\n\t\tif (!props.swipeable) return;\r\n\t\tconst { direction, deltaX, offsetX } = touch\r\n\t\tconst minSwipeDistance = 50;\r\n\t\tif (direction.value == 'horizontal' && offsetX.value >= minSwipeDistance) {\r\n\t\t\tconst index = getAvailableTabIndex(deltaX.value);\r\n\t\t\tif (index != -1) {\r\n\t\t\t\tonClick(index, tabs.value[index])\r\n\t\t\t}\r\n\t\t}\r\n\t\tupdateInnerStyle(0)\r\n\t}\r\n\r\n\tconst stopWatch = watch(tabs, (_v : TabPanel[]) => {\r\n\t\t// 鸿蒙增加项时渲染比较慢 需要延时一下\r\n\t\tsetTimeout(() => {\r\n\t\t\tmoveToActiveTab()\r\n\t\t}, 50)\r\n\r\n\t})\r\n\r\n\tconst stopValueWatch = watch(currentValue, (_v : number) => {\r\n\t\t\r\n\t\tif (tabs.value.length == 0) return\r\n\t\tmoveToActiveTab()\r\n\t\tupdateInnerStyle(0)\r\n\t\t\r\n\t\t\r\n\t})\r\n\tconst stopVisibleWatch = watch(() : boolean => props.visible, (v : boolean) => {\r\n\t\tif (!v) return\r\n\t\tsetTimeout(() => {\r\n\t\t\tmoveToActiveTab()\r\n\t\t\tupdateInnerStyle(0)\r\n\t\t}, 100)\r\n\t})\r\n\t\r\n\tconst updateTrackPosition = (progress: number)=>{\r\n\t\tif (!props.syncSwiper || !props.showLine || progress == 0 || isInteracting.value) return\r\n\t\tupdateDuration(0)\r\n\t\tconst currentIdx = currentIndex.value\r\n\t\tconst next = ()=> {\r\n\t\t\tconst direction = progress > 0 ? 1 : -1\r\n\t\t\t\t\t\tconst nextIdx = currentIdx + direction\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 边界检查\r\n\t\t\t\t\t\tif (nextIdx < 0 || nextIdx >= tabRects.value.length ) return\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 获取当前和下一个tab的位置信息\r\n\t\t\t\t\t\tconst currentTab = tabRects.value[currentIdx]\r\n\t\t\t\t\t\tconst nextTab = tabRects.value[nextIdx]\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 计算插值比例 (0~1)\r\n\t\t\t\t\t\tconst ratio = Math.abs(progress)\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 计算track的起始和结束位置\r\n\t\t\t\t\t\tconst currentPos = currentTab.left + (currentTab.width - trackLineWidth.value) / 2\r\n\t\t\t\t\t\tconst nextPos = nextTab.left + (nextTab.width - trackLineWidth.value) / 2\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 根据滚动方向计算最终位置\r\n\t\t\t\t\t\tconst newPosition = direction > 0 \r\n\t\t\t\t\t\t    ? currentPos + (nextPos - currentPos) * ratio\r\n\t\t\t\t\t\t    : currentPos - (currentPos - nextPos) * ratio\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 更新track位置（平台兼容写法）\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\t\ttrackDistance.value = newPosition\r\n\r\n\t\t}\r\n\t\tmeasureTabs().then(next)\r\n\t\t\r\n\t}\r\n\t// 监听swiper进度变化\r\n\twatch(():number => props.swiperProgress, (progress: number) => {\r\n\t\tupdateTrackPosition(progress)\r\n\t})\r\n\t\r\n\tonMounted(() => {\r\n\t\t// 鸿蒙时间上不确定\r\n\t\tnextTick(() => {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tif (tabs.value.length == 0) return\r\n\t\t\t\tmoveToActiveTab()\r\n\t\t\t\tupdateInnerStyle(0)\r\n\t\t\t}, 100)\r\n\t\t})\r\n\t})\r\n\r\n\tonUnmounted(() => {\r\n\t\tstopWatch()\r\n\t\tstopValueWatch()\r\n\t\tstopVisibleWatch()\r\n\t})\r\n\r\n\tprovide('LimeTabs', children)\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\t@import './index';\r\n</style>","import Component from '/Users/xyhc/Documents/veepai_uniappx/uni_modules/lime-tabs/components/l-tabs/l-tabs.uvue'\nwx.createComponent(Component)"],"names":["_useSlots","ref","getCurrentInstance","reactive","_useModel","computed","_a","index","getRect","getAllRect","__read","calcScrollOffset","clamp","nextTick","useTouch","ease","watch","onMounted","onUnmounted","provide","Component"],"mappings":"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"}