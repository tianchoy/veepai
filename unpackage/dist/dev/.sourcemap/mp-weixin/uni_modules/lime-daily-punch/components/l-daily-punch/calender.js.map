{"version":3,"file":"calender.js","sources":["uni_modules/lime-daily-punch/components/l-daily-punch/calender.uts"],"sourcesContent":["import { LDay, LYearMonth, LGridSize, LMonthData, LOptions } from '../../index'\r\n// import { LDay } from '../../utssdk/interface';\r\n\r\n\r\nexport class ArrowIcon {\r\n\tx : number = 0\r\n\ty : number = 0\r\n\tsize : number = 0\r\n\ttype : string = ''\r\n\tcolor : string = ''\r\n\tconstructor(x : number, y : number, size : number, type : string, color : string) {\r\n\t\tthis.x = x\r\n\t\tthis.y = y\r\n\t\tthis.size = size\r\n\t\tthis.type = type\r\n\t\tthis.color = color\r\n\t}\r\n\tdraw(ctx : CanvasRenderingContext2D) {\r\n\t\tconst { x, y, size, color, type } = this\r\n\t\t// 设置绘图的填充颜色\r\n\t\tctx.strokeStyle = color;\r\n\t\tctx.beginPath();\r\n\t\tctx.lineJoin = 'round'\r\n\t\tctx.lineWidth = 2\r\n\t\t// 根据箭头类型绘制不同的形状\r\n\t\tif (type === 'left') {\r\n\t\t\tctx.moveTo(x + size * 0.6042, y + size * 0.25);\r\n\t\t\tctx.lineTo(x + size * 0.3542, y + size * 0.5);\r\n\t\t\tctx.lineTo(x + size * 0.6042, y + size * 0.75);\r\n\r\n\t\t} else if (type === 'right') {\r\n\t\t\tctx.moveTo(x + size * (1 - 0.6042), y + size * 0.25);\r\n\t\t\tctx.lineTo(x + size * (1 - 0.3542), y + size * 0.5);\r\n\t\t\tctx.lineTo(x + size * (1 - 0.6042), y + size * 0.75);\r\n\t\t}\r\n\r\n\t\tctx.stroke()\r\n\t}\r\n\tisCoordinateInside(x : number, y : number) : boolean {\r\n\t\treturn x >= this.x && x <= this.x + this.size && y >= this.y && y <= this.y + this.size;\r\n\t}\r\n}\r\n\r\nexport class Day implements LDay {\r\n\tday : number = 0;\r\n\tmonth : number = 0;\r\n\tyear : number = 0;\r\n\tfullDay : string = '00';\r\n\tfullMonth : string = '00';\r\n\tfullDate : string = '';\r\n\tisBeforeToday : boolean = false;\r\n\tisToday : boolean = false\r\n\t// isCheckedIn: boolean = false;\r\n\tisCurrentMonth : boolean = false;\r\n\tprivate x : number = 0;\r\n\tprivate y : number = 0;\r\n\tprivate calendar : Calendar\r\n\twidth : number = 0;\r\n\theight : number = 0;\r\n\toriginalMonth : number = 0;\r\n\ttype : string = 'current'\r\n\tfontSize : number = 20\r\n\ttimestamp : number = 0\r\n\tconstructor(day : number, month : number, year : number, isCurrentMonth : boolean, isToday : boolean, isBeforeToday : boolean, calendar : Calendar) {\r\n\t\tthis.day = day;\r\n\t\tthis.month = month\r\n\t\tthis.year = year;\r\n\t\tthis.originalMonth = month - 1;\r\n\t\tthis.fullMonth = this.formatMonth(month)\r\n\t\tthis.fullDay = this.formatDay(day)\r\n\t\tthis.fullDate = `${year}-${this.fullMonth}-${this.fullDay}`;\r\n\t\tthis.isCurrentMonth = isCurrentMonth;\r\n\t\tthis.isBeforeToday = isBeforeToday;\r\n\t\tthis.isToday = isToday\r\n\t\tthis.calendar = calendar\r\n\t\tthis.timestamp = new Date(year, month - 1, day).getTime()\r\n\t}\r\n\r\n\tprivate formatDay(day : number) : string {\r\n\t\treturn `${day}`.padStart(2, '0');\r\n\t}\r\n\r\n\tprivate formatMonth(month : number) : string {\r\n\t\treturn `${month}`.padStart(2, '0');\r\n\t}\r\n\t\r\n\tisCoordinateInside(x : number, y : number) : boolean {\r\n\t\treturn x >= this.x && x <= this.x + this.width && y >= this.y && y <= this.y + this.height;\r\n\t}\r\n\r\n\tsetPosition(x : number, y : number) : void {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t}\r\n\r\n\tsetDimensions(width : number, height : number) : void {\r\n\t\tthis.width = width;\r\n\t\tthis.height = height;\r\n\t}\r\n\tprivate get opt(): LOptions{\r\n\t\treturn this.calendar.opt\r\n\t}\r\n\tget selectDate() : LDay | null {\r\n\t\treturn this.calendar.selectDate\r\n\t}\r\n\tset selectDate(_val: LDay| null) {\r\n\t\t\r\n\t}\r\n\tget canSupplement() : boolean {\r\n\t\t// 在今日之前 并且 未签到 并且 支持补签\r\n\t\treturn this.opt.canSupplement! && this.isBeforeToday && !this.isCheckedIn\r\n\t}\r\n\tset canSupplement(_v: boolean) {\r\n\t\t\r\n\t}\r\n\tget isCheckedIn() : boolean {\r\n\t\treturn this.calendar.signedDates.includes(this.timestamp)\r\n\t\t// return true\r\n\t\t// if (this.calendar.opt.signedDates == null) return false\r\n\t\t// return this.calendar.opt.signedDates.some((dateString : string) : boolean => {\r\n\t\t// \tconst [year, month, day] = dateString.split('-').map((v : string) : number => parseInt(v));\r\n\t\t// \treturn year == this.year && month == this.month && day == this.day\r\n\t\t// })\r\n\t}\r\n\tset isCheckedIn(_v:boolean) {\r\n\t\t\r\n\t}\r\n\tprivate drawCircle(ctx : CanvasRenderingContext2D, x : number, y : number, radius : number, color : string, border : boolean = false) {\r\n\t\tctx.beginPath();\r\n\t\tif (border) {\r\n\t\t\tctx.lineWidth = 1\r\n\t\t\tctx.strokeStyle = 'white'\r\n\t\t}\r\n\t\tctx.fillStyle = color;\r\n\t\tctx.arc(x, y, radius, 0, Math.PI * 2);\r\n\t\tctx.fill();\r\n\t\tif (border) {\r\n\t\t\tctx.stroke()\r\n\t\t}\r\n\t}\r\n\tdraw(ctx : CanvasRenderingContext2D) {\r\n\t\tconst size = Math.min(this.width, this.height) * 0.9\r\n\t\tconst centerX = this.x + this.width / 2\r\n\t\tconst centerY = this.y + this.height / 2\r\n\t\tconst color = this.opt.color!\r\n\t\tconst unsignedColor = this.opt.unsignedColor!\r\n\t\tconst selectedDayBgColor = this.opt.selectedDayBgColor!\r\n\t\tconst textColor = this.opt.textColor!\r\n\t\tconst disabledColor = this.opt.disabledColor!\r\n\t\tconst dayFontSize = this.opt.dayFontSize!\r\n\t\t\r\n\t\t\r\n\t\tctx.textAlign = 'center';\r\n\t\tctx.font = this.isToday ? `${dayFontSize - 2}px Arial` : `${dayFontSize}px Arial`;\r\n\t\tctx.textBaseline = 'middle';\r\n\r\n\t\t// 判断是否是当前选中日期\r\n\t\tconst isSelectedDate = this.selectDate == null || this.selectDate == this;\r\n\r\n\t\t// 设置字体颜色\r\n\t\tlet txtColor = this.type == 'current' ? textColor : disabledColor;\r\n\t\tif (this.isToday && !isSelectedDate) {\r\n\t\t\ttxtColor = color;\r\n\t\t}\r\n\r\n\t\t// 绘制选中效果\r\n\t\tif (this.selectDate != null && this.selectDate == this) {\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.fillStyle = selectedDayBgColor;\r\n\t\t\tctx.arc(centerX, centerY, size / 2, 0, Math.PI * 2);\r\n\t\t\tctx.fill();\r\n\t\t}\r\n\t\t\r\n\t\t// 绘制今日效果\r\n\t\tif (this.isToday && isSelectedDate) {\r\n\t\t\tthis.drawCircle(ctx, centerX, centerY, size / 2, color);\r\n\t\t\ttxtColor = 'white';\r\n\t\t\t\r\n\t\t}\r\n\t\t// 绘制已签到或可补签效果 小点\r\n\t\tif (this.type == 'current' && (this.isCheckedIn || this.canSupplement)) {\r\n\t\t\tthis.drawCircle(ctx, centerX, centerY + this.fontSize * 0.9, 4, this.isCheckedIn ? (this.isToday && isSelectedDate ? 'white' : color) : unsignedColor);\r\n\t\t}\r\n\r\n\t\t// 绘制文字\r\n\t\tctx.fillStyle = txtColor;\r\n\t\tctx.fillText(this.isToday ? '今天' : this.fullDay, centerX, centerY);\r\n\r\n\t}\r\n}\r\n\r\n\r\nexport class Calendar {\r\n\tprivate year : number = 0\r\n\tprivate month : number = 0\r\n\tprivate el : UniCanvasElement | null = null\r\n\tprivate ctx : CanvasRenderingContext2D | null = null\r\n\tprivate init : boolean = false\r\n\tprivate today : number = 0\r\n\tprivate currentMonth : number = 0\r\n\tprivate currentYear : number = 0\r\n\t// private headerHeight : number = 50\r\n\t// private weekHeight : number = 30\r\n\tprivate monthDateCache : Map<string, LMonthData>\r\n\tprivate week : string[] = []\r\n\tselectDate : LDay | null = null\r\n\tprivate containerHeight : number = 0\r\n\tprivate containerWidth : number = 0\r\n\tprivate arrowIcons : ArrowIcon[] = []\r\n\topt : LOptions = {\r\n\t\tcanSupplement: false,\r\n\t\tisFullCalendar: true,\r\n\t\tyearMonth: '',\r\n\t\tsignedDates: [],\r\n\t\tweek: ['周日', '周一', '周二', '周三', '周四', '周五', '周六'],\r\n\t\tweekStartsOn: 0,\r\n\t\tweekColor: '#BDC0C3',\r\n\t\tweekFontSize: 12,\r\n\t\tweekHeight: 40,\r\n\t\tselectedDayBgColor: 'rgba(0,0,0,0.06)',\r\n\t\tdayFontSize: 12,\r\n\t\ttextColor: '#1A1F24',\r\n\t\tdisabledColor: '#BDC0C3',\r\n\t\tmonthTitleHeight: 50,\r\n\t\tmonthTitleFontSize: 20,\r\n\t\tcolor: '#3B87F6',\r\n\t\tunsignedColor: '#F1A33A',\r\n\t}\r\n\r\n\tconstructor() {\r\n\t\tconst date = new Date()\r\n\t\tthis.currentYear = date.getFullYear()\r\n\t\tthis.currentMonth = date.getMonth() + 1\r\n\t\tthis.today = date.getDate()\r\n\t\tthis.monthDateCache = new Map<string, LMonthData>()\r\n\t\tthis.week = this.opt.week ?? []\r\n\t}\r\n\tget signedDates() : number[] {\r\n\t\tif (this.opt.signedDates == null) return []\r\n\t\tconst values : number[] = []\r\n\t\tthis.opt.signedDates!.forEach(item => {\r\n\t\t\tconst [year, month, day] = item.split('-').map((v : string) : number => parseInt(v));\r\n\t\t\tconst time = new Date(year, month - 1, day).getTime()\r\n\t\t\tif (!values.includes(time)) {\r\n\t\t\t\tvalues.push(time)\r\n\t\t\t}\r\n\t\t})\r\n\t\treturn values\r\n\t}\r\n\tget checkinDays() : number {\r\n\t\tif (this.signedDates.length == 0) return 0\r\n\t\tconst sortedDates = this.signedDates.sort((a, b):number => {\r\n\t\t\t// #ifdef APP-ANDROID\r\n\t\t\t// 这里的判断不能省略\r\n\t\t\tif (a.compareTo(b) == 0) {\r\n\t\t\t\treturn 0\r\n\t\t\t}\r\n\t\t\t// #endif\r\n\t\t\treturn b - a\r\n\t\t})\r\n\t\treturn this.calculateContinuousCheckinDays(sortedDates);\r\n\t}\r\n\tprivate calculateContinuousCheckinDays(sortedDates : number[]) : number {\r\n\t\tconst dayInMillis = 24 * 60 * 60 * 1000;\r\n\t\tconst todayTime = new Date(this.currentYear, this.currentMonth - 1, this.today).getTime();\r\n\t\tlet count = 0;\r\n\t\tlet streak = 0;\r\n\r\n\t\tfor (let i = 0; i < sortedDates.length; i++) {\r\n\t\t\tif (i == 0) {\r\n\t\t\t\t// 大于1天，即隔了一天就已经中断签到 不再计算\r\n\t\t\t\tif (todayTime - sortedDates[i] > dayInMillis) {\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t\tif (sortedDates[i] == todayTime || todayTime - sortedDates[i] == dayInMillis) {\r\n\t\t\t\t\tstreak = 1;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (sortedDates[i - 1] - sortedDates[i] == dayInMillis) {\r\n\t\t\t\t\tstreak++;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn streak;\r\n\t}\r\n\tsetCanvas(el : UniCanvasElement | null) {\r\n\t\tif (el == null) return\r\n\t\tthis.el = el\r\n\t\tthis.containerHeight = 6 * (this.opt.dayHeight ?? 0) + this.opt.weekHeight! + this.opt.monthTitleHeight! //6\r\n\t\tthis.containerWidth = this.el!.offsetWidth\r\n\t\tthis.el!.style.setProperty('height', this.containerHeight + 'px')\r\n\t\tthis.ctx = el.getContext('2d')!\r\n\t\tconst dpr = uni.getDeviceInfo().devicePixelRatio ?? 1;\r\n\t\t\r\n\t\tthis.el!.width = this.containerWidth * dpr;\r\n\t\tthis.el!.height = this.containerHeight * dpr;\r\n\t\tthis.ctx!.scale(dpr, dpr)\r\n\t\t// this.ctx = el.getDrawableContext()\r\n\t\t\r\n\t\t// this.ctx.fillStyle = 'red'\r\n\t\t// this.ctx.fillRect(0,0,100,100)\r\n\t}\r\n\tsetOptions(opt : LOptions) {\r\n\t\tlet datechange = false\r\n\t\tlet weekStartsOn = -1\r\n\t\tfor (let key in opt) {\r\n\t\t\tconst value = opt[key]\r\n\t\t\tif (key == 'yearMonth' && value != null && value != this.opt.yearMonth) {\r\n\t\t\t\tdatechange = true\r\n\t\t\t}\r\n\t\t\tif (key == 'weekStartsOn' && value != null && value != this.opt.weekStartsOn) {\r\n\t\t\t\tweekStartsOn = value as number\r\n\t\t\t}\r\n\t\t\tif (value != null) {\r\n\t\t\t\tthis.opt[key] = value\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (weekStartsOn != -1) {\r\n\t\t\tconst normalWeek = [...this.opt.week!]\r\n\t\t\tconst sIndex = weekStartsOn < 0 ? 0 : weekStartsOn >= normalWeek.length ? normalWeek.length - 1 : weekStartsOn\r\n\t\t\tnormalWeek.unshift(...normalWeek.slice(-sIndex))\r\n\t\t\tnormalWeek.length = 6\r\n\t\t\tthis.week = normalWeek\r\n\t\t}\r\n\r\n\t\tif (this.opt.yearMonth != '' && !this.init || datechange) {\r\n\t\t\tconst arr = this.opt.yearMonth!.split('-')\r\n\t\t\tthis.year = parseInt(arr[0])\r\n\t\t\tthis.month = parseInt(arr[1])\r\n\t\t\tthis.init = true\r\n\t\t}\r\n\t}\r\n\r\n\t/** 获取当月共多少天，也就是获取月的最后一天 */\r\n\tgetMonthDayLength(year : number, month : number) : number {\r\n\t\treturn new Date(year, month, 0).getDate()\r\n\t}\r\n\t// 获取当月第一天星期几\r\n\tgetFirstDayOfWeek(year : number, month : number, day : number = 1) : number {\r\n\t\treturn new Date(year, month - 1, day).getDay();\r\n\t}\r\n\t// 获取加/减一个月的日期\r\n\tgetOperateMonthDate(nowYear : number, nowMonth:number, num : number) : LYearMonth {\r\n\t\tlet month = nowMonth + num\r\n\t\tlet year = nowYear;\r\n\t\tif (month > 12) {\r\n\t\t\tmonth = 1;\r\n\t\t\tyear++;\r\n\t\t} else if (month < 1) {\r\n\t\t\tmonth = 12;\r\n\t\t\tyear--;\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tmonth,\r\n\t\t\tyear,\r\n\t\t} as LYearMonth\r\n\t}\r\n\r\n\tgenerateMonthDateCache(year : number = this.year, month : number = this.month) : LMonthData {\r\n\t\t// 检查是否可以切换到下个月\r\n\t\t// const canSwitchToNextMonth = this.currentYear > year || (this.currentYear == year && this.currentMonth > month + 1);\r\n\t\tconst key = `${year}-${month}`\r\n\t\tif (this.monthDateCache.has(key)) {\r\n\t\t\treturn this.monthDateCache.get(key)!\r\n\t\t}\r\n\t\tconst arr : LDay[] = []\r\n\t\tconst days = this.getMonthDayLength(year, month);\r\n\t\tconst firstday = this.getFirstDayOfWeek(year, month);\r\n\t\tconst beforeEmptyLength = (firstday + this.opt.weekStartsOn!) % 7 //this.getFirstDayOfWeek(year, month);\r\n\t\t// Math.ceil((days + beforeEmptyLength) / 7)\r\n\t\tconst afterEmptyLength = 5 * 7 - beforeEmptyLength - days //6 - this.getFirstDayOfWeek(year, month, days); //6\r\n\r\n\t\tconst last = this.getOperateMonthDate(year, month, -1);\r\n\t\tconst lastMonthEndDay = this.getMonthDayLength(last.year, last.month);\r\n\t\tconst next = this.getOperateMonthDate(year, month, 1);\r\n\t\tconst today = new Date(this.currentYear, this.currentMonth - 1, this.today).getTime();\r\n\t\tlet index = 0\r\n\t\tconst getGridSize = (i : number) : LGridSize => {\r\n\t\t\t// 确保this.el存在并且可以获取到边界矩形\r\n\t\t\tconst rect = this.el?.getBoundingClientRect();\r\n\r\n\r\n\t\t\tconst height = this.opt.dayHeight ?? 0;\r\n\r\n\t\t\tconst width = rect == null ? 0 : rect.width / 7;\r\n\r\n\t\t\t// 计算行和列\r\n\t\t\tconst row = Math.floor(i / 7);\r\n\t\t\tconst col = i % 7;\r\n\r\n\t\t\t// 计算网格单元的位置\r\n\t\t\tconst x = col * width;\r\n\t\t\tconst y = row * height + this.opt.monthTitleHeight! + this.opt.weekHeight!;\r\n\r\n\t\t\treturn {\r\n\t\t\t\tx, // 使用计算得到的x值\r\n\t\t\t\ty, // 使用计算得到的y值\r\n\t\t\t\twidth, // 使用计算得到的width值\r\n\t\t\t\theight // 使用正确的变量名height\r\n\t\t\t} as LGridSize;\r\n\t\t};\r\n\t\tfor (var i = 0; i < beforeEmptyLength; i++) {\r\n\t\t\tconst { x, y, width, height } = getGridSize(index);\r\n\t\t\tconst date = lastMonthEndDay - beforeEmptyLength + i + 1;\r\n\t\t\tconst time = new Date(last.year, last.month - 1, date).getTime()\r\n\t\t\tconst day = new Day(\r\n\t\t\t\tdate,\r\n\t\t\t\tlast.month,\r\n\t\t\t\tlast.year,\r\n\t\t\t\tlast.year == this.currentYear && last.month == this.currentMonth,\r\n\t\t\t\ttime == today,\r\n\t\t\t\ttime < today,\r\n\t\t\t\tthis\r\n\t\t\t)\r\n\t\t\tday.type = 'last'\r\n\t\t\tday.setPosition(x, y)\r\n\t\t\tday.setDimensions(width, height)\r\n\t\t\tarr.push(day)\r\n\t\t\tindex++\r\n\t\t}\r\n\t\tfor (var i = 0; i < days; i++) {\r\n\t\t\tconst { x, y, width, height } = getGridSize(index)\r\n\t\t\tconst date = i + 1;\r\n\t\t\tconst time = new Date(year, month - 1, date).getTime()\r\n\t\t\tconst day = new Day(\r\n\t\t\t\tdate,\r\n\t\t\t\tmonth,\r\n\t\t\t\tyear,\r\n\t\t\t\tyear == this.currentYear && month == this.currentMonth,\r\n\t\t\t\ttime == today,\r\n\t\t\t\ttime < today,\r\n\t\t\t\tthis)\r\n\t\t\tday.setPosition(x, y)\r\n\t\t\tday.setDimensions(width, height)\r\n\t\t\tarr.push(day)\r\n\t\t\tindex++\r\n\t\t}\r\n\t\tfor (var i = 0; i < afterEmptyLength; i++) {\r\n\t\t\tconst { x, y, width, height } = getGridSize(index)\r\n\t\t\tconst date = i + 1;\r\n\t\t\tconst time = new Date(next.year, next.month - 1, date).getTime()\r\n\t\t\tconst day = new Day(date,\r\n\t\t\t\tnext.month,\r\n\t\t\t\tnext.year,\r\n\t\t\t\tnext.year == this.currentYear && next.month == this.currentMonth,\r\n\t\t\t\ttime == today,\r\n\t\t\t\ttime < today,\r\n\t\t\t\tthis)\r\n\t\t\tday.type = 'next'\r\n\t\t\tday.setPosition(x, y)\r\n\t\t\tday.setDimensions(width, height)\r\n\t\t\tarr.push(day)\r\n\t\t\tindex++\r\n\t\t}\r\n\r\n\t\tconst monthData : LMonthData = {\r\n\t\t\tyear,\r\n\t\t\tmonth,\r\n\t\t\tdays: arr,\r\n\t\t}\r\n\t\tthis.monthDateCache.set(key, monthData)\r\n\t\treturn monthData\r\n\t}\r\n\tnext() {\r\n\t\tconst { year, month } = this.getOperateMonthDate(this.year, this.month, 1)\r\n\t\t// 检查是否可以切换到下个月\r\n\t\tconst canSwitchToNextMonth = this.currentYear > year || (this.currentYear == year && month - this.currentMonth <= 1);\r\n\t\tif (canSwitchToNextMonth) {\r\n\t\t\tthis.year = year\r\n\t\t\tthis.month = month\r\n\t\t\tthis.render(year, month)\r\n\t\t} else {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ticon: 'error',\r\n\t\t\t\ttitle: '往后最多查看一个月'\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\tlast() {\r\n\t\tconst { year, month } = this.getOperateMonthDate(this.year, this.month, -1)\r\n\t\tthis.year = year\r\n\t\tthis.month = month\r\n\t\tthis.render(year, month)\r\n\t}\r\n\t/**\r\n\t* 前往某一天 \r\n\t* @param {string} date 格式 YYYY-MM-DD\r\n\t*/ \r\n\tgoToDate(date : string | null = null) {\r\n\t\tif (date == null) {\r\n\t\t\tthis.render(this.currentYear, this.currentMonth, this.today)\r\n\t\t} else {\r\n\t\t\ttry {\r\n\t\t\t\tconst [year, month, day] = date.split('-').map((item) : number => parseInt(item))\r\n\t\t\t\tthis.render(year, month, day)\r\n\t\t\t} catch (e) {\r\n\t\t\t\tthrow new Error('参数有误')\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tprivate drawIcon(ctx : CanvasRenderingContext2D, size : number, x : number, y : number, arrow : string, color : string) {\r\n\t\t// 设置绘图的填充颜色\r\n\t\tctx.strokeStyle = color;\r\n\t\tctx.beginPath();\r\n\t\tctx.lineJoin = 'round'\r\n\t\tctx.lineWidth = 2\r\n\t\t// 根据箭头类型绘制不同的形状\r\n\t\tif (arrow === 'left') {\r\n\t\t\tctx.moveTo(x + size * 0.6042, y + size * 0.25);\r\n\t\t\tctx.lineTo(x + size * 0.3542, y + size * 0.5);\r\n\t\t\tctx.lineTo(x + size * 0.6042, y + size * 0.75);\r\n\r\n\t\t} else if (arrow === 'right') {\r\n\t\t\tctx.moveTo(x + size * (1 - 0.6042), y + size * 0.25);\r\n\t\t\tctx.lineTo(x + size * (1 - 0.3542), y + size * 0.5);\r\n\t\t\tctx.lineTo(x + size * (1 - 0.6042), y + size * 0.75);\r\n\t\t}\r\n\r\n\t\tctx.stroke()\r\n\t}\r\n\tprivate drawHead(monthData : LMonthData) {\r\n\t\tconst width = this.containerWidth\r\n\t\tif (this.ctx == null) return\r\n\t\tconst ctx = this.ctx!\r\n\t\tconst height = this.opt.monthTitleHeight!\r\n\t\t// ctx.fillStyle = 'rgba(0,0,0,0.1)'\r\n\t\t// ctx.rect(0,0,width, this.opt.monthTitleHeight!)\r\n\t\t// ctx.fill()\r\n\t\tctx.textAlign = 'center'\r\n\t\tctx.fillStyle = this.opt.textColor!\r\n\t\tctx.font = ` ${this.opt.monthTitleFontSize!}px sans-serif`\r\n\t\tctx.textBaseline = 'middle'\r\n\t\tctx.fillText(`${monthData.year}年` + `${monthData.month}`.padStart(2, '0') + '月', width * 0.5, height * 0.55)\r\n\t\tif (this.arrowIcons.length == 0) {\r\n\t\t\tconst offsetTop = (height - 30) / 2\r\n\t\t\tthis.arrowIcons.push(new ArrowIcon(0, offsetTop, 30, 'left', `#A0A5AA`))\r\n\t\t\tthis.arrowIcons.push(new ArrowIcon(width - 30, offsetTop, 30, 'right', `#A0A5AA`))\r\n\t\t}\r\n\t\tthis.arrowIcons.forEach(icon => {\r\n\t\t\ticon.draw(ctx)\r\n\t\t})\r\n\t}\r\n\tprivate drawWeek() {\r\n\t\tif (this.ctx == null) return\r\n\t\tconst ctx = this.ctx!\r\n\t\tctx.textAlign = 'center'\r\n\t\tctx.font = `${this.opt.weekFontSize}px Arial`\r\n\t\tctx.textBaseline = 'middle'\r\n\t\tctx.fillStyle = this.opt.weekColor!\r\n\t\tthis.week.forEach((week, index) => {\r\n\t\t\tctx.fillText(`${week}`, this.containerWidth / 7 * (index + 0.5), this.opt.monthTitleHeight! + this.opt.weekHeight! * 0.5)\r\n\t\t})\r\n\t}\r\n\trender(year : number = this.year, month : number = this.month, day : number | null = null) {\r\n\t\tconst monthData = this.generateMonthDateCache(year, month);\r\n\t\tif (day != null) {\r\n\t\t\tthis.selectDate = monthData.days.find((item) : boolean => item.day == day)\r\n\t\t}\r\n\t\tif (this.el != null && this.ctx != null) {\r\n\t\t\tthis.ctx!.clearRect(0, 0, this.containerWidth, this.containerHeight)\r\n\t\t\tthis.drawHead(monthData)\r\n\t\t\tthis.drawWeek()\r\n\r\n\t\t\tmonthData.days.forEach(day => {\r\n\t\t\t\tday.draw(this.ctx!)\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\treturn\r\n\t}\r\n\ttouch(e : UniPointerEvent) {\r\n\t\tif (this.el == null) return\r\n\t\tconst rect = this.el!.getBoundingClientRect()\r\n\t\tconst x = e.clientX - rect.left\r\n\t\tconst y = e.clientY - rect.top\r\n\r\n\t\t// 判断 是点了左右\r\n\t\tconst icon = this.arrowIcons.find((icon) : boolean => icon.isCoordinateInside(x, y))\r\n\r\n\t\tif (icon != null) {\r\n\t\t\tif (icon.type == 'left') {\r\n\t\t\t\tthis.last()\r\n\t\t\t} else {\r\n\t\t\t\tthis.next()\r\n\t\t\t}\r\n\t\t\tthis.opt.panelChange?.({\r\n\t\t\t\tyear: this.year,\r\n\t\t\t\tmonth: this.month\r\n\t\t\t} as LYearMonth)\r\n\t\t\treturn\r\n\t\t}\r\n\t\t// 判断是点了日历\r\n\t\tconst month = this.monthDateCache.get(`${this.year}-${this.month}`)\r\n\t\tif (month == null) return\r\n\t\tconst day = month.days.find((day) : boolean => day.isCoordinateInside(x, y))\r\n\t\t// 只有点击当前月的\r\n\t\tif (day != null && day.type == 'current') {\r\n\t\t\t// if(this.selectDate != day) {\r\n\t\t\t\tthis.selectDate = day\r\n\t\t\t\tthis.render()\r\n\t\t\t// }\r\n\t\t\tthis.opt.select?.(day)\r\n\t\t}\r\n\t}\r\n}"],"names":["__read","uni","i","day","icon"],"mappings":"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"}