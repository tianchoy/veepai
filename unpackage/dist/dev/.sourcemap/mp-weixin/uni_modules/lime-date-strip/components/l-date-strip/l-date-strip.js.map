{"version":3,"file":"l-date-strip.js","sources":["uni_modules/lime-date-strip/components/l-date-strip/l-date-strip.uvue","/Users/xyhc/Documents/veepai_uniappx/uni_modules/lime-date-strip/components/l-date-strip/l-date-strip.uvue?type=component"],"sourcesContent":["<template>\r\n\t<scroll-view \r\n\t\tclass=\"l-date-strip l-date-strip__scroll\"\r\n\t\t:scroll-x=\"true\"\r\n\t\t:scroll-left=\"scrollLeft\"\r\n\t\t:show-scrollbar=\"false\"\r\n\t\tdirection=\"horizontal\"\r\n\t\t:style=\"[styles]\"\r\n\t\tv-if=\"switchMode == 'none'\">\r\n\t\t\t<l-date-strip-item \r\n\t\t\t\t:dates=\"displayWeeks[0].dates\" \r\n\t\t\t\t:color=\"color\"\r\n\t\t\t\t:activeBgColor=\"activeBgColor\"\r\n\t\t\t\t:activeColor=\"activeColor\"\r\n\t\t\t\t:bgColor=\"bgColor\"\r\n\t\t\t\t:radius=\"radius\"\r\n\t\t\t\t:switchMode=\"switchMode\"\r\n\t\t\t\t:shape=\"shape\"\r\n\t\t\t\t@click=\"onClick\">\r\n\t\t\t</l-date-strip-item>\r\n\t</scroll-view>\r\n\t<swiper \r\n\t\tv-else\r\n\t\tclass=\"l-date-strip\" \r\n\t\t:style=\"[styles]\"\r\n\t\t:current=\"currentWeekIndex\" \r\n\t\t:circular=\"swiperCircular\" \r\n\t\t@animationfinish=\"swiperFinish\" \r\n\t\t@change=\"swiperChange\">\r\n\t\t<swiper-item v-for=\"(week, g) in displayWeeks\" :key=\"g\">\r\n\t\t\t<l-date-strip-item \r\n\t\t\t\t:dates=\"week.dates\" \r\n\t\t\t\t:color=\"color\"\r\n\t\t\t\t:activeBgColor=\"activeBgColor\"\r\n\t\t\t\t:activeColor=\"activeColor\"\r\n\t\t\t\t:bgColor=\"bgColor\"\r\n\t\t\t\t:radius=\"radius\"\r\n\t\t\t\t:switchMode=\"switchMode\"\r\n\t\t\t\t:shape=\"shape\"\r\n\t\t\t\t@click=\"onClick\">\r\n\t\t\t</l-date-strip-item>\r\n\t\t</swiper-item>\r\n\t</swiper>\r\n</template>\r\n<script lang=\"uts\" setup>\r\n\timport { DateStripProps, WeekDateCollection, DateStriPDay, DateType } from './type';\r\n\timport { getWeekRange, addDays, addWeeks, calcType, daysBetween } from './utils';\r\n\timport { unitConvert } from '@/uni_modules/lime-shared/unitConvert'\r\n\tconst emit = defineEmits(['change', 'select', 'scroll', 'panelChange', 'update:modelValue'])\r\n\tconst props = withDefaults(defineProps<DateStripProps>(), {\r\n\t\tweekdays: ['日', '一', '二', '三', '四', '五', '六'],\r\n\t\tfirstDayOfWeek: 1,\r\n\t\tshape: 'square',\r\n\t\tswitchMode: 'week'\r\n\t})\r\n\t// 当前选中的周索引\r\n\tconst currentWeekIndex = ref(0)\r\n\tconst scrollLeft = ref(0)\r\n\t// 是否循环滚动\r\n\tconst swiperCircular = ref(true);\r\n\tconst selectedDate = ref<Date|null>(null);\r\n\t// 计算一周的星期顺序\r\n\tconst firstDayOfWeek = computed(() : number => Math.min(Math.max(props.firstDayOfWeek, 0), 6));\r\n\t\r\n\t// 计算最小和最大日期\r\n\tconst today = new Date();\r\n\tconst minDate = computed(() : Date => (props.minDate != null ? new Date(props.minDate!) : today));\r\n\tconst maxDate = computed(() : Date => (props.maxDate != null\r\n\t\t? new Date(props.maxDate!)\r\n\t\t: addDays(today, 31))\r\n\t);\r\n\t\r\n\tconst days = computed(():number => {\r\n\t\treturn daysBetween(maxDate.value, minDate.value)\r\n\t})\r\n\t\r\n\tconst styles = computed(():Map<string, any>=>{\r\n\t\tconst style = new Map<string, any>()\r\n\t\t\r\n\t\tif(props.height != null) {\r\n\t\t\tstyle.set('height', props.height!)\r\n\t\t}\r\n\t\tif(props.bgColor != null) {\r\n\t\t\tstyle.set('background', props.bgColor!)\r\n\t\t}\r\n\t\treturn style\r\n\t})\r\n\t\r\n\tconst cache = new Map<number,WeekDateCollection>()\r\n\tconst createWeek = (currentStartDate: Date, length: number):WeekDateCollection => {\r\n\t\tconst dates : DateStriPDay[] = [];\r\n\t\tconst time = currentStartDate.getTime()\r\n\t\tif(cache.has(time)) {\r\n\t\t\treturn cache.get(time)!\r\n\t\t}\r\n\t\tfor (let i = 0; i < length; i++) {\r\n\t\t\tconst date = new Date(time);\r\n\t\t\tdate.setDate(currentStartDate.getDate() + i);\r\n\t\t\tconst week = date.getDay();\r\n\t\t\tconst year = date.getFullYear();\r\n\t\t\tconst month = date.getMonth() + 1; \r\n\t\t\tconst day =  date.getDate()\r\n\t\t\tconst dateObj:DateStriPDay = {\r\n\t\t\t\tkey: `${year}-${month}-${day}`,\r\n\t\t\t\tdate,\r\n\t\t\t\tyear,\r\n\t\t\t\tmonth,\r\n\t\t\t\tday,\r\n\t\t\t\ttext: `${day}`.padStart(2, '0'),\r\n\t\t\t\ttype: calcType(date, minDate.value, maxDate.value, selectedDate.value),\r\n\t\t\t\tprefix: props.weekdays[week],\r\n\t\t\t}\r\n\t\t\tdates.push(props.format != null ? props.format!(dateObj) : dateObj);\r\n\t\t}\r\n\t\tconst obj:WeekDateCollection = {\r\n\t\t\tstart: new Date(dates[0].year, dates[0].month - 1, dates[0].day).getTime(),\r\n\t\t\tend: new Date(dates[length - 1].year, dates[length - 1].month - 1, dates[length - 1].day).getTime(),\r\n\t\t\tdates\r\n\t\t} as WeekDateCollection\r\n\t\t\r\n\t\t// cache.set(time, obj)\r\n\t\t\r\n\t\treturn obj\r\n\t}\r\n\t\r\n\tconst currentDate = ref<Date>(today)\r\n\t\r\n\t// 计算要显示的三周数据\r\n\tconst displayWeeks = computed(() : WeekDateCollection[] => {\r\n\t\tconst weeks: WeekDateCollection[] = [];\r\n\t\tif(props.switchMode == 'week') {\r\n\t\t\tconst currentRange = getWeekRange(currentDate.value, firstDayOfWeek.value);\r\n\t\t\tconst offsetMap = new Map<number, number[]>([\r\n\t\t\t\t[0, [0, 1, -1]],\r\n\t\t\t\t[1, [-1, 0, 1]],\r\n\t\t\t\t[2, [1, -1, 0]],\r\n\t\t\t])\r\n\t\t\tlet indices = offsetMap.get(currentWeekIndex.value)!\r\n\t\t\tindices.forEach(i => {\r\n\t\t\t\t const weekDate = addWeeks(currentRange.start, i);\r\n\t\t\t\t weeks.push(createWeek(weekDate, 7)) \r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\t weeks.push(createWeek(minDate.value, days.value)) \r\n\t\t}\r\n\t\t\r\n\t\treturn weeks\r\n\t})\r\n\t\r\n\tconst swiperChange = (event : UniSwiperChangeEvent) => {\r\n\t\tconst delta = event.detail.current - currentWeekIndex.value;\r\n\t\tconst newDate = addWeeks(currentDate.value, delta == 1 || delta == -2 ? 1 : -1);\r\n\t\tcurrentDate.value = newDate;\r\n\t\tcurrentWeekIndex.value = event.detail.current;\r\n\t}\r\n\tconst swiperFinish = (_event : UniSwiperAnimationFinishEvent) => {\r\n\t\t\r\n\t}\r\n\t\r\n\tconst onClick = (day: DateStriPDay) => {\r\n\t\tif(day.type == 'disabled') return\r\n\t\tselectedDate.value = day.date\r\n\t\tconst v = day.date.getTime()\r\n\t\temit('change', v)\r\n\t\temit('select', v)\r\n\t\temit('update:modelValue', v)\r\n\t}\r\n\t\r\n\t\r\n\tconst scrollToDate = (date: Date) => {\r\n\t\tcurrentDate.value = date\r\n\t\tif(props.switchMode != 'none') return\r\n\t\tscrollLeft.value = unitConvert(props.gridWidth ?? 50)  *  daysBetween(date, minDate.value)\r\n\t}\r\n\t\r\n\twatchEffect(()=>{\r\n\t\tconst value = props.value ?? props.modelValue\r\n\t\tif(value == null) return\r\n\t\tselectedDate.value = new Date(value)\r\n\t})\r\n\t\r\n\tonMounted(()=>{\r\n\t\tnextTick(()=>{\r\n\t\t\tscrollToDate(currentDate.value)\r\n\t\t})\r\n\t})\r\n\t\r\n\tdefineExpose({\r\n\t\tscrollToDate\r\n\t})\r\n\t\r\n</script>\r\n<style lang=\"scss\">\r\n\t@import './index';\r\n</style>","import Component from '/Users/xyhc/Documents/veepai_uniappx/uni_modules/lime-date-strip/components/l-date-strip/l-date-strip.uvue'\nwx.createComponent(Component)"],"names":["ref","computed","addDays","daysBetween","calcType","getWeekRange","addWeeks","unitConvert","_a","watchEffect","onMounted","nextTick","Component"],"mappings":"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"}