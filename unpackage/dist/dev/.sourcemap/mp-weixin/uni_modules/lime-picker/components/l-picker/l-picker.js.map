{"version":3,"file":"l-picker.js","sources":["uni_modules/lime-picker/components/l-picker/l-picker.uvue","/Users/xyhc/Documents/veepai_uniappx/uni_modules/lime-picker/components/l-picker/l-picker.uvue?type=component"],"sourcesContent":["<template>\r\n\t<view class=\"l-picker\" :style=\"[styles]\" ref=\"pickerRef\">\r\n\t\t<view class=\"l-picker__toolbar\" :key=\"ohosShow\" v-if=\"cancelBtn != null || title != null || confirmBtn != null\">\r\n\t\t\t<text class=\"l-picker__cancel\" :key=\"ohosShow\" :style=\"cancelStyle??''\" v-if=\"cancelBtn != null\"\r\n\t\t\t\t@click=\"onCancel\">{{cancelBtn}}</text>\r\n\t\t\t<text class=\"l-picker__title\" :key=\"ohosShow\" :style=\"titleStyle??''\">{{title}}</text>\r\n\t\t\t<text class=\"l-picker__confirm\" :key=\"ohosShow\" :style=\"confirmStyle??''\" v-if=\"confirmBtn != null\"\r\n\t\t\t\t@click=\"onConfirm\">{{confirmBtn}}</text>\r\n\t\t</view>\r\n\t\t<slot name=\"header\"></slot>\r\n\t\t<view class=\"l-picker__main\" :style=\"[groupHeight != null ? { height:  groupHeight}: {}]\">\r\n\t\t\t<slot>\r\n\t\t\t\t<l-picker-item v-for=\"(options, i) in props.columns\" :options=\"options\" :key=\"i\" :column=\"i\"\r\n\t\t\t\t\t:value=\"pickerValue.length > i ? pickerValue[i]: null\"></l-picker-item>\r\n\t\t\t</slot>\r\n\t\t\t<view class=\"l-picker__empty\" v-if=\"isEmpty\">\r\n\t\t\t\t<slot name=\"empty\"></slot>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<slot name=\"footer\" />\r\n\t\t<view class=\"l-picker__loading\" ref=\"loadingRef\" v-if=\"loading\"\r\n\t\t\t:style=\"[loadingMaskColor != null ? {background: loadingMaskColor}: {}]\">\r\n\r\n\t\t\t<l-loading :size=\"loadingSize\" :color=\"loadingColor\"></l-loading>\r\n\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n<script lang=\"uts\" setup>\r\n\t/**\r\n\t * Picker 选择器组件\r\n\t * @description 多列数据选择器，支持级联数据展示和自定义样式配置\r\n\t * <br>插件类型：LPickerComponentPublicInstance \r\n\t * @tutorial https://ext.dcloud.net.cn/plugin?name=lime-picker\r\n\t * \r\n\t * @property {string} cancelBtn 取消按钮文字\r\n\t * @property {string | UTSJSONObject} cancelStyle 取消按钮样式\r\n\t * @property {string} confirmBtn 确定按钮文字\r\n\t * @property {string | UTSJSONObject} confirmStyle 确定按钮样式\r\n\t * @property {string} title 标题文字\r\n\t * @property {string | UTSJSONObject} titleStyle 标题样式\r\n\t * @property {UTSJSONObject} keys 字段别名配置（例：{value: 'id', label: 'name'}）\r\n\t * @property {PickerColumn[]} columns 选择器列数据（必填）\r\n\t * @property {PickerValue[]} modelValue 选中值（支持v-model）\r\n\t * @property {PickerValue[]} defaultValue 默认选中值\r\n\t * @property {PickerValue[]} value 选中值（兼容旧版）\r\n\t * @property {boolean} loading 是否显示加载状态\r\n\t * @property {string} loadingColor 加载图标颜色\r\n\t * @property {string} loadingMaskColor 加载遮罩颜色\r\n\t * @property {string} loadingSize 加载图标尺寸\r\n\t * @property {string} itemHeight 选项行高度\r\n\t * @property {string} itemColor 选项文字颜色\r\n\t * @property {string} itemFontSize 选项字体大小\r\n\t * @property {string} itemActiveColor 选中项颜色\r\n\t * @property {string} indicatorStyle 指示器样式\r\n\t * @property {string} bgColor 背景颜色\r\n\t * @property {string} groupHeight 选项组高度\r\n\t * @property {string} radius 圆角半径\r\n\t * @property {boolean} resetIndex 是否重置选中索引\r\n\t * \r\n\t * @event {Function} confirm 点击确定时触发（事件参数：PickerConfirmEvent）\r\n\t * @event {Function} cancel 点击取消时触发\r\n\t * @event {Function} change 值变化时触发（事件参数：PickerPickEvent）\r\n\t * @event {Function} column-change 列数据变化时触发（事件参数：PickerChangeInfo）\r\n\t */\r\n\timport { PickerProps, PickerColumn, PickerValue, PickerColumnItem, PickerConfirmEvent, PickerPickEvent } from './type';\r\n\timport { pushAt } from './utils';\r\n\timport { unitConvert } from '@/uni_modules/lime-shared/unitConvert'\r\n\r\n\r\n\r\n\tconst emit = defineEmits(['change', 'cancel', 'pick', 'confirm', 'update:modelValue', 'update:value']);\r\n\tconst props = withDefaults(defineProps<PickerProps>(), {\r\n\t\tcolumns: [] as PickerColumn[],\r\n\t\tloading: false,\r\n\t\tresetIndex: false,\r\n\t\tloadingSize: '64rpx'\r\n\t})\r\n\tconst pickerItemInstanceArray = reactive<LPickerItemComponentPublicInstance[]>([]);\r\n\tconst ohosShow = ref(0)\r\n\tconst modelValue = ref<PickerValue[]>(props.value ?? props.modelValue ?? props.defaultValue ?? [])\r\n\tconst pickerValue = computed({\r\n\t\tset(value : PickerValue[]) {\r\n\t\t\tif (value.join('') == modelValue.value.join('')) return\r\n\t\t\tmodelValue.value = value;\r\n\t\t\temit('update:modelValue', value)\r\n\t\t\temit('change', value)\r\n\t\t},\r\n\t\tget() : PickerValue[] {\r\n\t\t\treturn props.value ?? props.modelValue ?? modelValue.value\r\n\t\t}\r\n\t} as WritableComputedOptions<PickerValue[]>)\r\n\r\n\tconst isEmpty = computed(() : boolean => {\r\n\t\treturn props.columns.length == 0 && pickerItemInstanceArray.every(child => child.options.length == 0)\r\n\t})\r\n\tconst styles = computed(() : Map<string, any> => {\r\n\t\tconst style = new Map<string, any>()\r\n\t\tif (props.bgColor != null) {\r\n\t\t\tstyle.set('background', props.bgColor!)\r\n\t\t}\r\n\t\tif (props.radius != null) {\r\n\t\t\tstyle.set('border-top-left-radius', props.radius!)\r\n\t\t\tstyle.set('border-top-right-radius', props.radius!)\r\n\t\t}\r\n\t\treturn style\r\n\t})\r\n\r\n\tconst curIndexArray = ref<number[]>([]);\r\n\tconst curValueArray = ref([...pickerValue.value]);\r\n\tconst curItemArray : PickerColumnItem[] = []\r\n\tconst realColumns = computed(() : PickerColumn[] => {\r\n\t\tconst pickerColumns = pickerItemInstanceArray.map((child) : PickerColumn => child.options)\r\n\t\tif (pickerColumns.length > 0) {\r\n\t\t\treturn pickerColumns\r\n\t\t}\r\n\t\treturn props.columns\r\n\t})\r\n\r\n\tconst manageChildInList = (child : LPickerItemComponentPublicInstance, shouldAdd : boolean) => {\r\n\t\tconst index = pickerItemInstanceArray.indexOf(child);\r\n\t\tif (shouldAdd) {\r\n\t\t\tif (index != -1) return\r\n\t\t\tpickerItemInstanceArray.push(child)\r\n\t\t} else {\r\n\t\t\tif (index == -1) return\r\n\t\t\tpickerItemInstanceArray.splice(index, 1);\r\n\t\t}\r\n\t}\r\n\r\n\tconst updateItems = (item : PickerColumnItem, index : number, column : number) => {\r\n\t\tpushAt(curIndexArray.value, column, index)\r\n\t\tpushAt(curValueArray.value, column, item.value)\r\n\t\tpushAt(curItemArray, column, item)\r\n\t};\r\n\t\r\n\tconst updatePickerItems = () => {\r\n\t\tconst _indexs : number[] = []\r\n\t\tconst _values : any[] = []\r\n\t\tpickerItemInstanceArray.forEach((child, column) => {\r\n\t\t\tif (child.options.length == 0) return\r\n\t\t\tconst value = curValueArray.value.length > column ? curValueArray.value[column] : null;\r\n\r\n\t\t\tconst index = value == null ? 0 : child._.exposed.getIndexByValue(value);\r\n\t\t\tchild._.exposed.setIndex(index)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\t\tconst item = child.options[index]\r\n\t\t\t_indexs.push(index)\r\n\t\t\t_values.push(item.value)\r\n\r\n\t\t\tpushAt(curItemArray, column, item)\r\n\t\t\t// pushAt(curIndexArray.value, column, index)\r\n\t\t\t// pushAt(curValueArray.value, column, item.value)\r\n\t\t\t// // 不能改变单向数据流, 只有值不存在时候才处理\r\n\t\t\t// if(pickerValue.value.length == 0) {\r\n\t\t\t// \tpickerValue.value = [...curValueArray.value]\r\n\t\t\t// }\r\n\t\t\t// if(pickerValue.value.join('') == curValueArray.value.join('')) return\r\n\t\t\t// pickerValue.value = [...curValueArray.value]\r\n\t\t})\r\n\t\tif (curIndexArray.value.join('') == _indexs.join('')) return\r\n\t\tcurIndexArray.value = _indexs\r\n\t\tcurValueArray.value = _values\r\n\t\t// if(pickerValue.value.length == 0) {\r\n\t\tpickerValue.value = [...curValueArray.value]\r\n\t\t// }\r\n\t}\r\n\r\n\tconst onPick = (item : PickerColumnItem, index : number, column : number) => {\r\n\t\tif (curIndexArray.value[column] == index) return\r\n\t\tpushAt(curIndexArray.value, column, index)\r\n\t\tpushAt(curValueArray.value, column, item.value)\r\n\t\tpushAt(curItemArray, column, item)\r\n\t\tconst obj : PickerPickEvent = {\r\n\t\t\tvalues: curValueArray.value,\r\n\t\t\tcolumn,\r\n\t\t\tindex\r\n\t\t}\r\n\t\tpickerValue.value = [...curValueArray.value]\r\n\t\temit('pick', obj)\r\n\t};\r\n\r\n\tconst onCancel = (e : UniPointerEvent) => {\r\n\t\tupdatePickerItems()\r\n\t\temit('cancel', e)\r\n\t}\r\n\tconst onConfirm = (e : UniPointerEvent) => {\r\n\t\tconst values = [...curValueArray.value];\r\n\t\tconst indexs = [...curIndexArray.value];\r\n\t\tconst items = curItemArray.map((item) : PickerColumnItem => toRaw(item))\r\n\t\tif (pickerValue.value.join('') != values.join('')) {\r\n\t\t\tpickerValue.value = values;\r\n\t\t}\r\n\t\tconst obj : PickerConfirmEvent = {\r\n\t\t\tvalues,\r\n\t\t\tindexs,\r\n\t\t\titems\r\n\t\t}\r\n\t\temit('confirm', obj)\r\n\t}\r\n\tconst stopPickerValue = watch(pickerValue, () => {\r\n\t\tif (pickerValue.value.join('') == curValueArray.value.join('')) return\r\n\t\tcurValueArray.value = pickerValue.value.map((item : PickerValue) => item);\r\n\t\tupdatePickerItems()\r\n\t})\r\n\r\n\tconst stopColumns = watch(realColumns, () => {\r\n\t\tupdatePickerItems()\r\n\t\t// nextTick(() => {\r\n\t\t// \tsetTimeout(()=>{\r\n\t\t// \t\tupdatePickerItems()\r\n\t\t// \t},2000)\r\n\t\t\t\r\n\t\t// })\r\n\t})\r\n\t\r\n\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\r\n\tonMounted(() => {\r\n\t\tnextTick(() => {\r\n\t\t\t\r\n\t\t\tif (pickerValue.value.join('') != curValueArray.value.join('') && pickerValue.value.length > 0) {\r\n\t\t\t\tcurValueArray.value = [...pickerValue.value]\r\n\t\t\t\tupdatePickerItems()\r\n\t\t\t}\r\n\t\t})\r\n\t})\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\tonBeforeUnmount(() => {\r\n\t\tstopPickerValue()\r\n\t\tstopColumns()\r\n\t})\r\n\r\n\tprovide('limePicker', props)\r\n\tprovide('limePickerOnPick', onPick)\r\n\tprovide('limePickerUpdateItems', updateItems)\r\n\tprovide('limePickerItems', pickerItemInstanceArray)\r\n\tprovide('limePickerManageChildInList', manageChildInList)\r\n</script>\r\n<style lang=\"scss\">\r\n\t@import './index.scss';\r\n</style>","import Component from '/Users/xyhc/Documents/veepai_uniappx/uni_modules/lime-picker/components/l-picker/l-picker.uvue'\nwx.createComponent(Component)"],"names":["reactive","ref","computed","_b","_a","pushAt","toRaw","watch","onMounted","nextTick","onBeforeUnmount","provide","Component"],"mappings":"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"}