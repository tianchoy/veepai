{"version":3,"sources":["uni_modules/lime-daily-punch/components/l-daily-punch/l-daily-punch.uvue"],"sourcesContent":["<template>\n\t<view class=\"calender\">\n\t\t<canvas ref=\"dailyRef\" id=\"l-daily-punch\" class=\"l-daily-punch\" :style=\"[styles]\" @click=\"onClick\"></canvas>\n\t</view>\n</template>\n<script setup lang=\"uts\">\n\timport { Calendar} from './calender'\n\timport { PropType } from 'vue'\n\timport { unitConvert } from '@/uni_modules/lime-shared/unitConvert';\n\timport { LDay,  LOptions, LYearMonth } from '../../index';\n\tconst emits = defineEmits(['select', 'panelChange', 'streak'])\n\tconst props = defineProps({\n\t\tcanSupplement: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t},\n\t\tisFullCalendar: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t},\n\t\tyearMonth: {\n\t\t\ttype: String,\n\t\t\tdefault: () : string => {\n\t\t\t\tconst date = new Date();\n\t\t\t\tconst year = date.getFullYear();\n\t\t\t\tconst month = (date.getMonth() + 1).toString().padStart(2, '0'); // 确保月份是两位数\n\t\t\t\treturn `${year}-${month}`;\n\t\t\t}\n\t\t},\n\t\tsignedDates: {\n\t\t\ttype: Array as PropType<string[]>,\n\t\t\tdefault: () : string[] => {\n\t\t\t\treturn [] as string[];\n\t\t\t},\n\t\t\tvalidator: (value : string[]):boolean => {\n\t\t\t\t// 简单的验证函数，确保每个元素都是有效的日期字符串\n\t\t\t\treturn value.every((date : string) : boolean => /^\\d{4}-\\d{2}-\\d{2}$/.test(date));\n\t\t\t}\n\t\t},\n\n\t\tdayHeight: {\n\t\t\ttype: Object,\n\t\t\tdefault: 76\n\t\t},\n\n\n\n\n\n\n\n\t\tweek: {\n\t\t\ttype: Array as PropType<string[]>,\n\t\t\tdefault: () : string[] => ['周日', '周一', '周二', '周三', '周四', '周五', '周六']\n\t\t},\n\t\tweekStartsOn: {\n\t\t\ttype: Number,\n\t\t\tdefault: 6,\n\t\t\tvalidator: (value:number):boolean => value <= 6\n\t\t},\n\t\tweekColor: {\n\t\t\ttype: String,\n\t\t\tdefault: '#BDC0C3'\n\t\t},\n\t\tweekFontSize: {\n\t\t\ttype: Number,\n\t\t\tdefault: 14\n\t\t},\n\t\tweekHeight: {\n\t\t\ttype: Number,\n\t\t\tdefault: 30\n\t\t},\n\t\tselectedDayBgColor: {\n\t\t\ttype: String,\n\t\t\tdefault: 'rgba(0,0,0,0.06)'\n\t\t},\n\t\tdayFontSize: {\n\t\t\ttype: Number,\n\t\t\tdefault: 16\n\t\t},\n\t\ttextColor: {\n\t\t\ttype: String,\n\t\t\tdefault: '#1A1F24'\n\t\t},\n\t\tdisabledColor: {\n\t\t\ttype: String,\n\t\t\tdefault: '#BDC0C3'\n\t\t},\n\t\tmonthTitleHeight: {\n\t\t\ttype: Number,\n\t\t\tdefault: 50\n\t\t},\n\t\tmonthTitleFontSize: {\n\t\t\ttype: Number,\n\t\t\tdefault: 20\n\t\t},\n\t\tcolor: {\n\t\t\ttype: String,\n\t\t\tdefault: '#3B87F6'\n\t\t},\n\t\tunsignedColor: {\n\t\t\ttype: String,\n\t\t\tdefault: '#F1A33A'\n\t\t},\n\t})\n\tlet drawRef = ref<UniCanvasElement|null>(null)\n\tlet calender:Calendar|null = null\n\t\n\t\n\tconst styles = computed(():Map<string, any> => {\n\t\tconst style = new Map<string, any>()\n\t\tstyle.set('height', `${6 * unitConvert(props.dayHeight) + props.weekHeight + props.monthTitleHeight}px`)\n\t\t\n\t\treturn style\n\t})\n\t\n\tconst onClick = (e: UniPointerEvent) => {\n\t\tcalender?.touch(e)\n\t}\n\t\n\tconst setOpt = () => {\n\t\tconst opt:LOptions = {\n\t\t\tcanSupplement: props.canSupplement,\n\t\t\tisFullCalendar: props.isFullCalendar,\n\t\t\tyearMonth: props.yearMonth,\n\t\t\tsignedDates: [...props.signedDates],\n\t\t\tdayHeight: unitConvert(props.dayHeight),\n\t\t\tweek: props.week as string[],\n\t\t\tweekStartsOn: props.weekStartsOn,\n\t\t\tweekColor: props.weekColor,\n\t\t\tweekFontSize: props.weekFontSize,\n\t\t\tweekHeight: props.weekHeight,\n\t\t\tselectedDayBgColor: props.selectedDayBgColor,\n\t\t\tdayFontSize: props.dayFontSize,\n\t\t\ttextColor: props.textColor,\n\t\t\tdisabledColor: props.disabledColor,\n\t\t\tmonthTitleHeight: props.monthTitleHeight,\n\t\t\tmonthTitleFontSize: props.monthTitleFontSize,\n\t\t\tcolor:props.color,\n\t\t\tunsignedColor: props.unsignedColor,\n\t\t\tselect: (e: LDay) => {\n\t\t\t\temits('select', e)\n\t\t\t},\n\t\t\tpanelChange: (e: LYearMonth) => {\n\t\t\t\temits('panelChange', e)\n\t\t\t}\n\t\t}\n\t\tif(calender == null) return\n\t\tcalender!.setOptions(opt)\n\t}\n\twatchEffect(() => {\n\t\tsetOpt()\n\t\tif(calender == null) return\n\t\tcalender!.render()\n\t\temits('streak', calender!.checkinDays)\n\t})\n\tconst instance = getCurrentInstance()!.proxy!\n\t\n\n\t// 异步调用方式, 跨平台写法\n\tuni.createCanvasContextAsync({\n\t\tid: 'l-daily-punch',\n\t\tcomponent: instance,\n\t\tsuccess: (context : CanvasContext) => {\n\t\t\tconst canvasContext = context.getContext('2d')!;\n\t\t\tconst canvas = canvasContext.canvas;\n\t\t\tcalender = new Calendar()\n\t\t\tsetOpt()\n\t\t\tcalender!.setCanvas(canvas)\n\t\t\tcalender!.render()\n\t\t\temits('streak', calender!.checkinDays)\n\t\t}\n\t})\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n</script>\n<style lang=\"scss\">\n\t.l-daily-punch {\n\t\twidth: 100%;\n\t\t// height: 75 * 6 + 50px + 40px;\n\t}\n\t.calender{\n\t\tmargin:0 30rpx;\n\t}\n</style>"],"names":[],"mappings":";;;;;;;;;;;;;+BAgKK;;;;;;;;;;;;;;;;;;;;;;;;;;;YAtJJ,IAAA,MAAA,OAAA,MAAA,EAAA,OAAA,yBAAA,GAAA,CAAA,EAAA;gBAAA,MAAA,IAAA,CAAA,QAAA;YAAA;YACA,IAAM,QAAQ;YA8Fd,IAAI,UAAU,IAAI,mBAAuB,IAAI;YAC7C,IAAI,sBAAyB,IAAI;YAGjC,IAAM,SAAS,SAAS,OAAG,IAAI,MAAM,EAAE,GAAG,EAAI;gBAC7C,IAAM,QAAQ,AAAI,IAAI,MAAM,EAAE,GAAG;gBACjC,MAAM,GAAG,CAAC,UAAU,KAAG,CAAA,CAAC,GAAG,YAAY,MAAM,SAAS,IAAI,MAAM,UAAU,GAAG,MAAM,gBAAgB,AAAhB,IAAgB;gBAEnG,OAAO;YACR;;YAEA,IAAM,UAAU,IAAC,GAAG,gBAAmB;gBACtC,UAAU,MAAM;YACjB;YAEA,IAAM,SAAS,KAAK;gBACnB,IAAM,eACL,gBAAe,MAAM,aAAa,EAClC,iBAAgB,MAAM,cAAc,EACpC,YAAW,MAAM,SAAS,EAC1B,cAAiB,MAAM,WAAW,UAClC,YAAW,YAAY,MAAM,SAAS,GACtC,OAAM,MAAM,IAAI,CAAA,EAAA,UAAI,MAAM,GAC1B,eAAc,MAAM,YAAY,EAChC,YAAW,MAAM,SAAS,EAC1B,eAAc,MAAM,YAAY,EAChC,aAAY,MAAM,UAAU,EAC5B,qBAAoB,MAAM,kBAAkB,EAC5C,cAAa,MAAM,WAAW,EAC9B,YAAW,MAAM,SAAS,EAC1B,gBAAe,MAAM,aAAa,EAClC,mBAAkB,MAAM,gBAAgB,EACxC,qBAAoB,MAAM,kBAAkB,EAC5C,QAAM,MAAM,KAAK,EACjB,gBAAe,MAAM,aAAa,EAClC,SAAQ,IAAC,QAAW;oBACnB,MAAM,UAAU;gBACjB;kBACA,cAAa,IAAC,cAAiB;oBAC9B,MAAM,eAAe;gBACtB;;gBAED,IAAG,YAAY,IAAI;oBAAE;;gBACrB,WAAU,UAAU,CAAC;YACtB;YACA,YAAY,KAAK;gBAChB;gBACA,IAAG,YAAY,IAAI;oBAAE;;gBACrB,WAAU,MAAM;gBAChB,MAAM,UAAU,WAAU,WAAW;YACtC;;YACA,IAAM,WAAW,uBAAsB,KAAK;YAI5C,6DACC,KAAI,iBACJ,YAAW,UACX,UAAS,IAAC,SAAU,cAAiB;gBACpC,IAAM,gBAAgB,QAAQ,UAAU,CAAC;gBACzC,IAAM,SAAS,cAAc,MAAM;gBACnC,WAAW;gBACX;gBACA,WAAU,SAAS,CAAC;gBACpB,WAAU,MAAM;gBAChB,MAAM,UAAU,WAAU,WAAW;YACtC;;;uBA1KD,IAEO,QAAA,IAFD,WAAM,aAAU;oBACrB,IAA4G,UAAA,IAApG,SAAI,YAAW,QAAG,iBAAgB,WAAM,iBAAiB,WAAK,IAAA;wBAAG,MAAA;qBAAM,GAAI,aAAO"}