{"version":3,"sources":["uni_modules/lime-picker/components/l-picker-item/l-picker-item.uvue","uni_modules/lime-clipboard/utssdk/interface.uts"],"sourcesContent":["<template>\r\n\t<picker-view \r\n\t\tclass=\"l-picker-item__group\"\r\n\t\t:style=\"{opacity: options.length > 0 ? 1 : 0}\"\r\n\t\t:indicator-style=\"indicatorStyles\" \r\n\t\t:value=\"innerIndex\" \r\n\t\t@change=\"handlePick\"\r\n\t\tindicator-class=\"l-picker-item__indicator\">\r\n\t\t<picker-view-column class=\"l-picker-item__wrapper\">\r\n\r\n\t\t\t<view ref=\"itemRef\"></view>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\t</picker-view-column>\r\n\t</picker-view>\r\n</template>\r\n<script lang=\"uts\" setup>\r\n\t/**\r\n\t * PickerItem 选择器子项组件\r\n\t * @description 用于构建多列选择器的单个列项，通常作为 Picker 组件的子组件使用\r\n\t * <br>插件类型：LPickerItemComponentPublicInstance \r\n\t * @tutorial https://ext.dcloud.net.cn/plugin?name=lime-picker\r\n\t * \r\n\t * @property {PickerColumnItem[]} options 当前列的选项列表（必填）\r\n\t * @property {PickerValue} value 当前选中值\r\n\t * @property {number} column 列索引标识（从0开始计数）\r\n\t * @property {string | number} name 列名称标识符\r\n\t */\r\n\timport { unitConvert } from '@/uni_modules/lime-shared/unitConvert'\r\n\timport { clamp } from '@/uni_modules/lime-shared/clamp'\r\n\timport { PickerItemProps, ManageChildInList, OnPick, UpdateItems } from './type';\r\n\timport { PickerColumnItem, PickerValue } from '../l-picker/type';\r\n\tconst instance = getCurrentInstance()!;\r\n\tconst props = withDefaults(defineProps<PickerItemProps>(), {\r\n\t\toptions: [] as PickerColumnItem[],\r\n\t\tcolumn: -1,\r\n\t\tresetIndex: false\r\n\t})\r\n\tconst picker = inject<LPickerComponentPublicInstance | null>('limePicker', null);\r\n\tconst pickerItemInstanceArray = inject<LPickerItemComponentPublicInstance[] | null>('limePickerItems', null);\r\n\tconst manageChildInList = inject<ManageChildInList | null>('limePickerManageChildInList', null);\r\n\tmanageChildInList?.(instance.proxy! as LPickerItemComponentPublicInstance, true)\r\n\tconst onPick = inject<OnPick | null>('limePickerOnPick', null);\r\n\tconst updateItems = inject<UpdateItems | null>('limePickerUpdateItems', null);\r\n\t// web 如果初始是0 当数据加载后 无法指向0\r\n\r\n\r\n\r\n\r\n\tconst curIndex = ref(0)\r\n\r\n\tconst curValue = ref<PickerValue | null>(props.value);\r\n\tconst column = computed(() : number => props.column != -1 ? props.column : pickerItemInstanceArray?.indexOf(instance.proxy! as LPickerItemComponentPublicInstance) ?? props.column);\r\n\r\n\tconst elementPosition = computed(() : boolean[] => {\r\n\t\tconst totalElements = pickerItemInstanceArray?.length ?? 0;\r\n\t\treturn [column.value == 0, column.value == totalElements - 1]\r\n\t});\r\n\tconst innerIndex = computed(() : number[] => [curIndex.value])\r\n\tconst indicatorStyles = computed(() : string => {\r\n\t\tconst [isFirst, isLast] = elementPosition.value\r\n\t\tlet style = ``\r\n\t\t\r\n\t\tif(isFirst) {\r\n\t\t\tstyle+= 'border-top-left-radius:12rpx; border-bottom-left-radius:12rpx;'\r\n\t\t}\r\n\t\tif(isLast) {\r\n\t\t\tstyle+= 'border-top-right-radius:12rpx; border-bottom-right-radius:12rpx;'\r\n\t\t}\r\n\t\treturn `\r\n\t\t\t${style}\r\n\t\t\theight: ${picker?.itemHeight ?? '50px'};\r\n\t\t\tbackground-color: rgba(0, 0, 0, 0.04); ${picker?.indicatorStyle}`\r\n\t})\r\n\tconst itemStyles = computed(() : Map<string, any> => {\r\n\t\tconst style = new Map<string, any>();\r\n\t\tif (picker?.itemColor != null) {\r\n\t\t\tstyle.set('color', picker.itemColor!)\r\n\t\t}\r\n\t\tif (picker?.itemFontSize != null) {\r\n\t\t\tstyle.set('font-size', picker.itemFontSize!)\r\n\t\t}\r\n\t\tif(picker?.itemHeight != null) {\r\n\t\t\tstyle.set('line-height', picker.itemHeight!)\r\n\t\t\tstyle.set('height', picker.itemHeight!)\r\n\t\t}\r\n\t\treturn style\r\n\t})\r\n\tconst itemActiveStyles = computed(() : Map<string, any> => {\r\n\t\tconst style = new Map<string, any>();\r\n\t\tif (picker?.itemActiveColor != null) {\r\n\t\t\tstyle.set('color', picker.itemActiveColor!)\r\n\t\t}\r\n\t\tif (picker?.itemActiveFontWeight != null) {\r\n\t\t\tstyle.set('font-weight', picker.itemActiveFontWeight!)\r\n\t\t}\r\n\t\treturn style\r\n\t})\r\n\r\n\r\n\tconst getIndexByValue = (val : PickerValue | null) => {\r\n\t\tlet defaultIndex = 0;\r\n\t\tif (val != null) {\r\n\t\t\tdefaultIndex = props.options.findIndex((item) => item.value == val);\r\n\t\t}\r\n\t\treturn defaultIndex < 0 ? 0 : defaultIndex;\r\n\t};\r\n\r\n\tconst setIndex = (index : number) => {\r\n\t\tlet lastIndex = curIndex.value\r\n\t\tlet _index = clamp(index, 0,  props.options.length - 1)\r\n\t\tif(props.options.length > _index) {\r\n\t\t\tcurIndex.value = _index;\r\n\t\t\tcurValue.value = props.options[_index].value\r\n\t\t}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\t\r\n\t}\r\n\tconst setValue = (value : PickerValue | null) => {\r\n\t\tif (value == curValue.value) return\r\n\t\tcurValue.value = value\r\n\t\tconst index = getIndexByValue(value)\r\n\t\tsetIndex(index)\r\n\t}\r\n\tconst setOptions = () => { }\r\n\tconst setUpdateItems = () => {\r\n\t\tconst index = clamp(curIndex.value, 0,  props.options.length - 1)\r\n\t\tconst curItem = props.options.length > index ? props.options[index] : null;\r\n\t\tif (curItem == null) return\r\n\t\tupdateItems?.(curItem, index, column.value);\r\n\t}\r\n\t\r\n\tconst handlePick = (e : UniPickerViewChangeEvent) => {\r\n\t\tif(props.options.length == 0) return\r\n\t\tconst index = clamp(e.detail.value[0], 0,  props.options.length - 1);\r\n\t\tconst curItem = props.options[index];\r\n\t\tif(index == curIndex.value) return\r\n\t\tsetIndex(index)\r\n\t\tonPick?.(curItem, index, column.value);\r\n\t}\r\n\r\n\tconst stopValue = watch(() : PickerValue | null => props.value, (v : PickerValue | null) => {\r\n\t\tsetValue(v);\r\n\t\tsetUpdateItems();\r\n\t}, { immediate: true })\r\n\r\n\r\n\tconst itemRef = ref<UniElement | null>(null)\r\n\tconst updateItemStyle = () => {\r\n\t\tif (itemRef.value != null) {\r\n\t\t\tconst ctx = itemRef.value!.getDrawableContext()!\r\n\t\t\tconst height = unitConvert(picker?.itemHeight ?? 50);\r\n\t\t\tconst fontSize = unitConvert(picker?.itemFontSize ?? '32rpx');\r\n\t\t\tconst rect = itemRef.value!.getBoundingClientRect()\r\n\t\t\tconst x = itemRef.value!.offsetWidth / 2;\r\n\t\t\tconst itemActiveFontWeight = picker?.itemActiveFontWeight ?? 700\r\n\t\t\titemRef.value!.style.setProperty('height', height * props.options.length);\r\n\t\t\tctx.reset()\r\n\t\t\tctx.fillStyle = picker?.itemActiveColor ?? 'rgba(0,0,0,0.88)';\r\n\t\t\tctx.font = `${fontSize}px`;\r\n\t\t\tctx.textAlign = 'center'\r\n\t\t\tctx.lineWidth = 0.5\r\n\t\t\t\r\n\t\t\tprops.options.forEach((item, index) => {\r\n\t\t\t\tconst y = height * index + fontSize + (height - fontSize) * 0.4;  //(height - fontSize * 1.1)\r\n\t\t\t\tctx.fillText(item.label, x, y)\r\n\t\t\t\tif (index == curIndex.value && itemActiveFontWeight > 600) {\r\n\t\t\t\t\tctx.strokeText(item.label, x, y)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tctx.update()\r\n\t\t}\r\n\t}\r\n\t// 防止更新后尺寸不对\r\n\twatchEffect(()=> {\r\n\t\tif(curIndex.value > 0){}\r\n\t\tnextTick(updateItemStyle)\r\n\t})\r\n\tconst stop = watch(() : PickerColumnItem[] => props.options, (v : PickerColumnItem[], o : PickerColumnItem[]) => {\r\n\t\tnextTick(updateItemStyle)\r\n\t})\r\n\t\r\n\tconst resizeObserver = new UniResizeObserver((entries : Array<UniResizeObserverEntry>) => {\r\n\t\tupdateItemStyle()\r\n\t}) \r\n\tconst stopWatch = watch(():UniElement|null => itemRef.value, (el:UniElement|null) => {\r\n\t\tif(el== null) return\r\n\t\tresizeObserver.observe(el)\r\n\t})\r\n\t// onMounted(() => {\r\n\t// \tnextTick(updateItemStyle)\r\n\t// })\r\n\t\r\n\r\n\tonBeforeUnmount(() => {\r\n\t\tmanageChildInList?.(instance.proxy! as LPickerItemComponentPublicInstance, false)\r\n\t\t\r\n\r\n\t\tstop()\r\n\t\tstopWatch()\r\n\t\tresizeObserver.disconnect()\r\n\r\n\t})\r\n\t// onMounted(()=>{\r\n\t// \tif(props.options.length > 0 && curIndex.value == -1) {\r\n\t// \t\tcurIndex.value = 0\r\n\t// \t}\r\n\t// })\r\n\tdefineExpose({\r\n\t\tsetIndex,\r\n\t\tsetValue,\r\n\t\t// setOptions,\r\n\t\t// setUpdateItems,\r\n\t\tgetIndexByValue\r\n\t})\r\n</script>\r\n<style lang=\"scss\">\r\n\t@import './index';\r\n</style>",null],"names":[],"mappings":"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"}