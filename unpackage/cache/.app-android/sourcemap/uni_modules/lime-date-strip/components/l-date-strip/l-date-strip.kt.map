{"version":3,"sources":["uni_modules/lime-date-strip/components/l-date-strip/l-date-strip.uvue","uni_modules/uni-wifi/utssdk/interface.uts"],"sourcesContent":["<template>\r\n\t<scroll-view \r\n\t\tclass=\"l-date-strip l-date-strip__scroll\"\r\n\t\t:scroll-x=\"true\"\r\n\t\t:scroll-left=\"scrollLeft\"\r\n\t\t:show-scrollbar=\"false\"\r\n\t\tdirection=\"horizontal\"\r\n\t\t:style=\"[styles]\"\r\n\t\tv-if=\"switchMode == 'none'\">\r\n\t\t\t<l-date-strip-item \r\n\t\t\t\t:dates=\"displayWeeks[0].dates\" \r\n\t\t\t\t:color=\"color\"\r\n\t\t\t\t:activeBgColor=\"activeBgColor\"\r\n\t\t\t\t:activeColor=\"activeColor\"\r\n\t\t\t\t:bgColor=\"bgColor\"\r\n\t\t\t\t:radius=\"radius\"\r\n\t\t\t\t:switchMode=\"switchMode\"\r\n\t\t\t\t:shape=\"shape\"\r\n\t\t\t\t@click=\"onClick\">\r\n\t\t\t</l-date-strip-item>\r\n\t</scroll-view>\r\n\t<swiper \r\n\t\tv-else\r\n\t\tclass=\"l-date-strip\" \r\n\t\t:style=\"[styles]\"\r\n\t\t:current=\"currentWeekIndex\" \r\n\t\t:circular=\"swiperCircular\" \r\n\t\t@animationfinish=\"swiperFinish\" \r\n\t\t@change=\"swiperChange\">\r\n\t\t<swiper-item v-for=\"(week, g) in displayWeeks\" :key=\"g\">\r\n\t\t\t<l-date-strip-item \r\n\t\t\t\t:dates=\"week.dates\" \r\n\t\t\t\t:color=\"color\"\r\n\t\t\t\t:activeBgColor=\"activeBgColor\"\r\n\t\t\t\t:activeColor=\"activeColor\"\r\n\t\t\t\t:bgColor=\"bgColor\"\r\n\t\t\t\t:radius=\"radius\"\r\n\t\t\t\t:switchMode=\"switchMode\"\r\n\t\t\t\t:shape=\"shape\"\r\n\t\t\t\t@click=\"onClick\">\r\n\t\t\t</l-date-strip-item>\r\n\t\t</swiper-item>\r\n\t</swiper>\r\n</template>\r\n<script lang=\"uts\" setup>\r\n\timport { DateStripProps, WeekDateCollection, DateStriPDay, DateType } from './type';\r\n\timport { getWeekRange, addDays, addWeeks, calcType, daysBetween } from './utils';\r\n\timport { unitConvert } from '@/uni_modules/lime-shared/unitConvert'\r\n\tconst emit = defineEmits(['change', 'select', 'scroll', 'panelChange', 'update:modelValue'])\r\n\tconst props = withDefaults(defineProps<DateStripProps>(), {\r\n\t\tweekdays: ['日', '一', '二', '三', '四', '五', '六'],\r\n\t\tfirstDayOfWeek: 1,\r\n\t\tshape: 'square',\r\n\t\tswitchMode: 'week'\r\n\t})\r\n\t// 当前选中的周索引\r\n\tconst currentWeekIndex = ref(0)\r\n\tconst scrollLeft = ref(0)\r\n\t// 是否循环滚动\r\n\tconst swiperCircular = ref(true);\r\n\tconst selectedDate = ref<Date|null>(null);\r\n\t// 计算一周的星期顺序\r\n\tconst firstDayOfWeek = computed(() : number => Math.min(Math.max(props.firstDayOfWeek, 0), 6));\r\n\t\r\n\t// 计算最小和最大日期\r\n\tconst today = new Date();\r\n\tconst minDate = computed(() : Date => (props.minDate != null ? new Date(props.minDate!) : today));\r\n\tconst maxDate = computed(() : Date => (props.maxDate != null\r\n\t\t? new Date(props.maxDate!)\r\n\t\t: addDays(today, 31))\r\n\t);\r\n\t\r\n\tconst days = computed(():number => {\r\n\t\treturn daysBetween(maxDate.value, minDate.value)\r\n\t})\r\n\t\r\n\tconst styles = computed(():Map<string, any>=>{\r\n\t\tconst style = new Map<string, any>()\r\n\t\t\r\n\t\tif(props.height != null) {\r\n\t\t\tstyle.set('height', props.height!)\r\n\t\t}\r\n\t\tif(props.bgColor != null) {\r\n\t\t\tstyle.set('background', props.bgColor!)\r\n\t\t}\r\n\t\treturn style\r\n\t})\r\n\t\r\n\tconst cache = new Map<number,WeekDateCollection>()\r\n\tconst createWeek = (currentStartDate: Date, length: number):WeekDateCollection => {\r\n\t\tconst dates : DateStriPDay[] = [];\r\n\t\tconst time = currentStartDate.getTime()\r\n\t\tif(cache.has(time)) {\r\n\t\t\treturn cache.get(time)!\r\n\t\t}\r\n\t\tfor (let i = 0; i < length; i++) {\r\n\t\t\tconst date = new Date(time);\r\n\t\t\tdate.setDate(currentStartDate.getDate() + i);\r\n\t\t\tconst week = date.getDay();\r\n\t\t\tconst year = date.getFullYear();\r\n\t\t\tconst month = date.getMonth() + 1; \r\n\t\t\tconst day =  date.getDate()\r\n\t\t\tconst dateObj:DateStriPDay = {\r\n\t\t\t\tkey: `${year}-${month}-${day}`,\r\n\t\t\t\tdate,\r\n\t\t\t\tyear,\r\n\t\t\t\tmonth,\r\n\t\t\t\tday,\r\n\t\t\t\ttext: `${day}`.padStart(2, '0'),\r\n\t\t\t\ttype: calcType(date, minDate.value, maxDate.value, selectedDate.value),\r\n\t\t\t\tprefix: props.weekdays[week],\r\n\t\t\t}\r\n\t\t\tdates.push(props.format != null ? props.format!(dateObj) : dateObj);\r\n\t\t}\r\n\t\tconst obj:WeekDateCollection = {\r\n\t\t\tstart: new Date(dates[0].year, dates[0].month - 1, dates[0].day).getTime(),\r\n\t\t\tend: new Date(dates[length - 1].year, dates[length - 1].month - 1, dates[length - 1].day).getTime(),\r\n\t\t\tdates\r\n\t\t} as WeekDateCollection\r\n\t\t\r\n\t\t// cache.set(time, obj)\r\n\t\t\r\n\t\treturn obj\r\n\t}\r\n\t\r\n\tconst currentDate = ref<Date>(today)\r\n\t\r\n\t// 计算要显示的三周数据\r\n\tconst displayWeeks = computed(() : WeekDateCollection[] => {\r\n\t\tconst weeks: WeekDateCollection[] = [];\r\n\t\tif(props.switchMode == 'week') {\r\n\t\t\tconst currentRange = getWeekRange(currentDate.value, firstDayOfWeek.value);\r\n\t\t\tconst offsetMap = new Map<number, number[]>([\r\n\t\t\t\t[0, [0, 1, -1]],\r\n\t\t\t\t[1, [-1, 0, 1]],\r\n\t\t\t\t[2, [1, -1, 0]],\r\n\t\t\t])\r\n\t\t\tlet indices = offsetMap.get(currentWeekIndex.value)!\r\n\t\t\tindices.forEach(i => {\r\n\t\t\t\t const weekDate = addWeeks(currentRange.start, i);\r\n\t\t\t\t weeks.push(createWeek(weekDate, 7)) \r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\t weeks.push(createWeek(minDate.value, days.value)) \r\n\t\t}\r\n\t\t\r\n\t\treturn weeks\r\n\t})\r\n\t\r\n\tconst swiperChange = (event : UniSwiperChangeEvent) => {\r\n\t\tconst delta = event.detail.current - currentWeekIndex.value;\r\n\t\tconst newDate = addWeeks(currentDate.value, delta == 1 || delta == -2 ? 1 : -1);\r\n\t\tcurrentDate.value = newDate;\r\n\t\tcurrentWeekIndex.value = event.detail.current;\r\n\t}\r\n\tconst swiperFinish = (_event : UniSwiperAnimationFinishEvent) => {\r\n\t\t\r\n\t}\r\n\t\r\n\tconst onClick = (day: DateStriPDay) => {\r\n\t\tif(day.type == 'disabled') return\r\n\t\tselectedDate.value = day.date\r\n\t\tconst v = day.date.getTime()\r\n\t\temit('change', v)\r\n\t\temit('select', v)\r\n\t\temit('update:modelValue', v)\r\n\t}\r\n\t\r\n\t\r\n\tconst scrollToDate = (date: Date) => {\r\n\t\tcurrentDate.value = date\r\n\t\tif(props.switchMode != 'none') return\r\n\t\tscrollLeft.value = unitConvert(props.gridWidth ?? 50)  *  daysBetween(date, minDate.value)\r\n\t}\r\n\t\r\n\twatchEffect(()=>{\r\n\t\tconst value = props.value ?? props.modelValue\r\n\t\tif(value == null) return\r\n\t\tselectedDate.value = new Date(value)\r\n\t})\r\n\t\r\n\tonMounted(()=>{\r\n\t\tnextTick(()=>{\r\n\t\t\tscrollToDate(currentDate.value)\r\n\t\t})\r\n\t})\r\n\t\r\n\tdefineExpose({\r\n\t\tscrollToDate\r\n\t})\r\n\t\r\n</script>\r\n<style lang=\"scss\">\r\n\t@import './index';\r\n</style>",null],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;4BAyKuB,MAAM;;8DAAN,MAAM;;;;;;;;;;;;YAzH5B,IAAA,KAAA,OAAA,MAAA,EAAA,OAAA,yBAAA,GAAA,CAAA,EAAA;gBAAA,MAAA,IAAA,CAAA,QAAA;YAAA;YACA,IAAM,QAAQ;YAOd,IAAM,mBAAmB,IAAI,CAAC;YAC9B,IAAM,aAAa,IAAI,CAAC;YAExB,IAAM,iBAAiB,IAAI,IAAI;YAC/B,IAAM,eAAe,IAAI,OAAW,IAAI;YAExC,IAAM,iBAAiB,SAAS,OAAK,MAAM;uBAAI,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,MAAM,cAAc,EAAE,CAAC,GAAG,CAAC;;;YAG5F,IAAM,QAAQ,AAAI;YAClB,IAAM,UAAU,SAAS,OAAK;uBAAS,IAAA,MAAM,OAAO,IAAI,IAAI;oBAAO,KAAK,MAAM,OAAO;;oBAAK;;;;YAC1F,IAAM,UAAU,SAAS,OAAK;uBAAS,IAAA,MAAM,OAAO,IAAI,IAAI;oBACrD,KAAK,MAAM,OAAO;;oBACtB,QAAQ,OAAO,EAAE;;;;YAGpB,IAAM,OAAO,SAAS,OAAG,MAAM,CAAG;gBACjC,OAAO,YAAY,QAAQ,KAAK,EAAE,QAAQ,KAAK;YAChD;;YAEA,IAAM,SAAS,SAAS,OAAG,IAAI,MAAM,EAAE,GAAG,EAAG;gBAC5C,IAAM,QAAQ,AAAI,IAAI,MAAM,EAAE,GAAG;gBAEjC,IAAG,MAAM,MAAM,IAAI,IAAI,EAAE;oBACxB,MAAM,GAAG,CAAC,UAAU,MAAM,MAAM;;gBAEjC,IAAG,MAAM,OAAO,IAAI,IAAI,EAAE;oBACzB,MAAM,GAAG,CAAC,cAAc,MAAM,OAAO;;gBAEtC,OAAO;YACR;;YAEA,IAAM,QAAQ,AAAI,IAAI,MAAM;YAC5B,IAAM,aAAa,IAAC,kBAAkB,MAAM,QAAQ,MAAM,sBAAuB;gBAChF,IAAM,gCAAyB,KAAE;gBACjC,IAAM,OAAO,iBAAiB,OAAO;gBACrC,IAAG,MAAM,GAAG,CAAC,OAAO;oBACnB,OAAO,MAAM,GAAG,CAAC;;oBAElB;oBAAK,IAAI,YAAI,CAAC;oBAAd,MAAgB,IAAI;wBACnB,IAAM,OAAO,AAAI,KAAK;wBACtB,KAAK,OAAO,CAAC,iBAAiB,OAAO,KAAK;wBAC1C,IAAM,OAAO,KAAK,MAAM;wBACxB,IAAM,OAAO,KAAK,WAAW;wBAC7B,IAAM,QAAQ,KAAK,QAAQ,KAAK,CAAC;wBACjC,IAAM,MAAO,KAAK,OAAO;wBACzB,IAAM,uBACL,MAAK,KAAG,OAAI,MAAI,QAAK,MAAI,KACzB,OAAA,MACA,OAAA,MACA,QAAA,OACA,MAAA,KACA,OAAM,CAAA,KAAG,GAAG,EAAG,QAAQ,CAAC,CAAC,EAAE,MAC3B,OAAM,SAAS,MAAM,QAAQ,KAAK,EAAE,QAAQ,KAAK,EAAE,aAAa,KAAK,GACrE,SAAQ,MAAM,QAAQ,CAAC,KAAK;wBAE7B,MAAM,IAAI,CAAC,IAAA,MAAM,MAAM,IAAI,IAAI;4BAAG,MAAM,MAAM,GAAE;;4BAAW;;wBAAO;wBAjBvC;;;gBAmB5B,IAAM,6CACL,QAAO,AAAI,KAAK,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,OAAO,IACxE,MAAK,AAAI,KAAK,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,EAAE,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,EAAE,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,GAAG,EAAE,OAAO,IACjG,QAAA;gBAKD,OAAO;YACR;YAEA,IAAM,cAAc,IAAI,MAAM;YAG9B,IAAM,eAAe,SAAS,oCAA4B;gBACzD,IAAM,sCAA8B,KAAE;gBACtC,IAAG,MAAM,UAAU,IAAI,QAAQ;oBAC9B,IAAM,eAAe,aAAa,YAAY,KAAK,EAAE,eAAe,KAAK;oBACzE,IAAM,YAAY,AAAI,IAAI,MAAM,WAAE,MAAM,GAAI;wBAC3C;AAAC,6BAAC;4BAAE;AAAC,iCAAC;AAAE,iCAAC;gCAAE,CAAC,CAAC;6BAAC;yBAAC;wBACf;AAAC,6BAAC;4BAAE;gCAAC,CAAC,CAAC;AAAE,iCAAC;AAAE,iCAAC;6BAAC;yBAAC;wBACf;AAAC,6BAAC;4BAAE;AAAC,iCAAC;gCAAE,CAAC,CAAC;AAAE,iCAAC;6BAAC;yBAAC;qBACf;oBACD,IAAI,UAAU,UAAU,GAAG,CAAC,iBAAiB,KAAK;oBAClD,QAAQ,OAAO,CAAC,IAAA,EAAI;wBAClB,IAAM,WAAW,SAAS,aAAa,KAAK,EAAE;wBAC9C,MAAM,IAAI,CAAC,WAAW,UAAU,CAAC;oBACnC;uBACM;oBACL,MAAM,IAAI,CAAC,WAAW,QAAQ,KAAK,EAAE,KAAK,KAAK;;gBAGjD,OAAO;YACR;;YAEA,IAAM,eAAe,IAAC,OAAQ,qBAAwB;gBACrD,IAAM,QAAQ,MAAM,MAAM,CAAC,OAAO,GAAG,iBAAiB,KAAK;gBAC3D,IAAM,UAAU,SAAS,YAAY,KAAK,EAAE,IAAA,SAAS,CAAC,IAAI,SAAS,CAAC,CAAC;AAAG,qBAAC;;oBAAG,CAAC,CAAC;;gBAAA;gBAC9E,YAAY,KAAK,GAAG;gBACpB,iBAAiB,KAAK,GAAG,MAAM,MAAM,CAAC,OAAO;YAC9C;YACA,IAAM,eAAe,IAAC,QAAS,8BAAiC,CAEhE;YAEA,IAAM,UAAU,IAAC,kBAAqB;gBACrC,IAAG,IAAI,IAAI,IAAI;oBAAY;;gBAC3B,aAAa,KAAK,GAAG,IAAI,IAAI;gBAC7B,IAAM,IAAI,IAAI,IAAI,CAAC,OAAO;gBAC1B,KAAK,UAAU;gBACf,KAAK,UAAU;gBACf,KAAK,qBAAqB;YAC3B;YAGA,IAAM,eAAe,IAAC,MAAM,KAAQ;gBACnC,YAAY,KAAK,GAAG;gBACpB,IAAG,MAAM,UAAU,IAAI;oBAAQ;;gBAC/B,WAAW,KAAK,GAAG,YAAY,MAAM,SAAS,IAAI,EAAE,IAAM,YAAY,MAAM,QAAQ,KAAK;YAC1F;YAEA,YAAY,KAAI;gBACf,IAAM,QAAQ,MAAM,KAAK,IAAI,MAAM,UAAU;gBAC7C,IAAG,SAAS,IAAI;oBAAE;;gBAClB,aAAa,KAAK,GAAG,AAAI,KAAK;YAC/B;;YAEA,UAAU,KAAI;gBACb,SAAS,KAAI;oBACZ,aAAa,YAAY,KAAK;gBAC/B;;YACD;;YAEA,+BACC;;;uBApLM,IAAA,KAAA,UAAU,IAAA;oBAPjB,IAmBc,eAAA,gBAlBb,WAAM,qCACL,cAAU,IAAI,EACd,iBAAa,MAAA,aACb,oBAAgB,KAAK,EACtB,eAAU,cACT,WAAK,IAAA;wBAAG,MAAA;qBAAM;wBAEd,IAUoB,8BAAA,IATlB,WAAO,MAAA,aAAY,CAAA,CAAA,CAAA,CAAI,KAAK,EAC5B,WAAO,KAAA,KAAK,EACZ,mBAAe,KAAA,aAAa,EAC5B,iBAAa,KAAA,WAAW,EACxB,aAAS,KAAA,OAAO,EAChB,YAAQ,KAAA,MAAM,EACd,gBAAY,KAAA,UAAU,EACtB,WAAO,KAAA,KAAK,EACZ,aAAO;;;;;;;;;;;;;;oBAGX,IAqBS,UAAA,gBAnBR,WAAM,gBACL,WAAK,IAAA;wBAAG,MAAA;qBAAM,GACd,aAAS,MAAA,mBACT,cAAU,MAAA,iBACV,uBAAiB,cACjB,cAAQ;wBACT,IAYc,UAAA,IAAA,EAAA,cAAA,UAAA,CAZmB,MAAA,eAAY,IAAxB,MAAM,GAAN,SAAI,UAAA,GAAA,CAAA;mCAAzB,IAYc,eAAA,IAZkC,SAAK,IAAC;gCACrD,IAUoB,8BAAA,IATlB,WAAO,KAAK,KAAK,EACjB,WAAO,KAAA,KAAK,EACZ,mBAAe,KAAA,aAAa,EAC5B,iBAAa,KAAA,WAAW,EACxB,aAAS,KAAA,OAAO,EAChB,YAAQ,KAAA,MAAM,EACd,gBAAY,KAAA,UAAU,EACtB,WAAO,KAAA,KAAK,EACZ,aAAO"}