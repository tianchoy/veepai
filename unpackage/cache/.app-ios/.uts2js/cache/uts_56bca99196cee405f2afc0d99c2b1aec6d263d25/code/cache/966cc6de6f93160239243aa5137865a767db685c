{"code":"import { useCssVars as _useCssVars, unref as _unref, defineComponent as _defineComponent } from 'vue';\nimport { ref, reactive, onMounted } from 'vue';\nimport { getElementById } from '@/uni_modules/uts-video';\n// 视频源\nexport default /*#__PURE__*/ _defineComponent({\n    __name: 'index',\n    setup(__props, _a) {\n        var __expose = _a.expose;\n        __expose();\n        _useCssVars((_ctx = null) => { return (new UTSJSONObject({\n            \"00a60067-rulerWidth\\ \\+\\ \\'px\\'\": (rulerWidth.value + 'px')\n        })); });\n        const videoSrc = ref('https://example.com/sample.mp4');\n        const videoContext = ref(null);\n        // 视频信息\n        const videoDuration = ref(0);\n        const currentTime = ref(0);\n        // 刻度尺相关\n        const majorTicks = reactive([]);\n        const minorTicks = reactive([]);\n        const pixelsPerSecond = ref(50); // 每秒对应的像素数\n        const rulerWidth = ref(0);\n        const scrollLeft = ref(0);\n        const indicatorPosition = ref(0);\n        // 选择区域相关\n        const selectionStart = ref(0);\n        const selectionEnd = ref(0);\n        const selectionWidth = ref(0);\n        const isSelecting = ref(false);\n        // 初始化视频上下文\n        onMounted(() => {\n            videoContext.value = getElementById('myVideo');\n            // 获取屏幕宽度作为刻度尺宽度\n            const systemInfo = uni.getSystemInfoSync();\n            rulerWidth.value = systemInfo.windowWidth * 2; // 两倍屏幕宽度\n        });\n        // 视频元数据加载完成\n        const onVideoLoaded = (event = null) => {\n            videoDuration.value = event.detail.duration;\n            generateTimeRuler();\n        };\n        // 视频时间更新\n        const onTimeUpdate = (event = null) => {\n            currentTime.value = event.detail.currentTime;\n            updateIndicatorPosition();\n        };\n        // 生成时间刻度尺\n        const generateTimeRuler = () => {\n            const duration = videoDuration.value;\n            const totalPixels = duration * pixelsPerSecond.value;\n            // 生成主刻度（每分钟一个）\n            for (let i = 0; i <= Math.ceil(duration / 60); i++) {\n                const time = i * 60;\n                if (time <= duration) {\n                    majorTicks.push({\n                        time: time,\n                        position: time * pixelsPerSecond.value,\n                        label: formatTime(time)\n                    });\n                }\n            }\n            // 生成次刻度（每10秒一个）\n            for (let i = 0; i <= Math.ceil(duration / 10); i++) {\n                const time = i * 10;\n                if (time <= duration && time % 60 !== 0) { // 避免与主刻度重复\n                    minorTicks.push({\n                        time: time,\n                        position: time * pixelsPerSecond.value\n                    });\n                }\n            }\n        };\n        // 更新当前时间指示器位置\n        const updateIndicatorPosition = () => {\n            indicatorPosition.value = currentTime.value * pixelsPerSecond.value - scrollLeft.value;\n            // 自动滚动保持指示器在可视区域\n            const screenWidth = uni.getSystemInfoSync().windowWidth;\n            if (indicatorPosition.value < 50) {\n                scrollLeft.value = Math.max(0, currentTime.value * pixelsPerSecond.value - 50);\n            }\n            else if (indicatorPosition.value > screenWidth - 50) {\n                scrollLeft.value = currentTime.value * pixelsPerSecond.value - (screenWidth - 50);\n            }\n        };\n        // 滚动事件处理\n        const onScroll = (event = null) => {\n            scrollLeft.value = event.detail.scrollLeft;\n            updateIndicatorPosition();\n        };\n        // 触摸开始选择区域\n        const onTouchStart = (event = null) => {\n            isSelecting.value = true;\n            const touchX = event.touches[0].pageX;\n            selectionStart.value = touchX;\n            selectionEnd.value = touchX;\n            selectionWidth.value = 0;\n        };\n        // 触摸移动选择区域\n        const onTouchMove = (event = null) => {\n            if (!isSelecting.value)\n                return null;\n            const touchX = event.touches[0].pageX;\n            selectionEnd.value = touchX;\n            // 计算选择区域宽度和方向\n            if (selectionEnd.value > selectionStart.value) {\n                selectionWidth.value = selectionEnd.value - selectionStart.value;\n            }\n            else {\n                selectionWidth.value = selectionStart.value - selectionEnd.value;\n                selectionStart.value = selectionEnd.value;\n            }\n        };\n        // 触摸结束选择区域\n        const onTouchEnd = () => {\n            isSelecting.value = false;\n        };\n        // 播放视频\n        const play = () => {\n            var _a;\n            (_a = videoContext.value) === null || _a === void 0 ? null : _a.play();\n        };\n        // 暂停视频\n        const pause = () => {\n            var _a;\n            (_a = videoContext.value) === null || _a === void 0 ? null : _a.pause();\n        };\n        // 回放选中区域\n        const replaySelection = () => {\n            var _a, _b;\n            if (selectionWidth.value <= 0)\n                return null;\n            const startTime = (selectionStart.value + scrollLeft.value) / pixelsPerSecond.value;\n            const endTime = (selectionStart.value + scrollLeft.value + selectionWidth.value) / pixelsPerSecond.value;\n            // 设置当前时间为选择区域开始时间\n            currentTime.value = startTime;\n            (_a = videoContext.value) === null || _a === void 0 ? null : _a.seek(startTime);\n            // 播放到结束时间后暂停\n            const checkTime = () => {\n                var _a;\n                if (currentTime.value >= endTime) {\n                    (_a = videoContext.value) === null || _a === void 0 ? null : _a.pause();\n                }\n                else {\n                    requestAnimationFrame(checkTime);\n                }\n            };\n            (_b = videoContext.value) === null || _b === void 0 ? null : _b.play();\n            requestAnimationFrame(checkTime);\n        };\n        // 格式化时间显示 (MM:SS)\n        const formatTime = (seconds) => {\n            const mins = Math.floor(seconds / 60);\n            const secs = Math.floor(seconds % 60);\n            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n        };\n        const __returned__ = { videoSrc, videoContext, videoDuration, currentTime, majorTicks, minorTicks, pixelsPerSecond, rulerWidth, scrollLeft, indicatorPosition, selectionStart, selectionEnd, selectionWidth, isSelecting, onVideoLoaded, onTimeUpdate, generateTimeRuler, updateIndicatorPosition, onScroll, onTouchStart, onTouchMove, onTouchEnd, play, pause, replaySelection, formatTime };\n        Object.defineProperty(__returned__, '__isScriptSetup', { enumerable: false, value: true });\n        return __returned__;\n    }\n});\n//# sourceMappingURL=/Users/xyhc/Documents/veepai_uniappx/pages/index/index.uvue?vue&type=script&setup=true&lang.uts.js.map","references":["/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts"],"uniExtApis":["uni.getSystemInfoSync"],"map":"{\"version\":3,\"file\":\"index.uvue?vue&type=script&setup=true&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"index.uvue?vue&type=script&setup=true&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
