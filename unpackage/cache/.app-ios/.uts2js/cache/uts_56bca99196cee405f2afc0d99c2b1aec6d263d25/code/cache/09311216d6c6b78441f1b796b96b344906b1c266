{"code":"import { __awaiter } from \"tslib\";\n// @ts-nocheck\nimport { raf } from '@/uni_modules/lime-shared/raf';\nexport function useTransition(options) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n    const state = ref(false);\n    const display = ref(false);\n    const inited = ref(false);\n    const classes = ref('');\n    const name = ref((_a = options.defaultName) !== null && _a !== void 0 ? _a : 'fade');\n    const enterClass = (_b = options.enterClass) !== null && _b !== void 0 ? _b : '';\n    const enterActiveClass = (_c = options.enterActiveClass) !== null && _c !== void 0 ? _c : '';\n    const enterToClass = (_d = options.enterToClass) !== null && _d !== void 0 ? _d : '';\n    const leaveActiveClass = (_e = options.leaveActiveClass) !== null && _e !== void 0 ? _e : '';\n    const leaveToClass = (_f = options.leaveToClass) !== null && _f !== void 0 ? _f : '';\n    const leaveClass = (_g = options.leaveClass) !== null && _g !== void 0 ? _g : '';\n    const appear = (_h = options.appear) !== null && _h !== void 0 ? _h : false;\n    const duration = (_j = options.duration) !== null && _j !== void 0 ? _j : 300;\n    let status = '';\n    let isTransitionEnd = false;\n    let isTransitioning = false;\n    let timeoutId = -1;\n    const emitEvent = (event) => {\n        var _a;\n        (_a = options.emits) === null || _a === void 0 ? void 0 : _a.call(options, event);\n    };\n    // 结束\n    const finished = () => {\n        if (isTransitionEnd)\n            return;\n        isTransitionEnd = true;\n        emitEvent(`after-${status}`);\n        if (display.value && !state.value) {\n            display.value = false;\n        }\n    };\n    const sleep = () => {\n        return new Promise((resolve) => {\n            nextTick(() => {\n                raf(() => {\n                    var _a, _b, _c, _d;\n                    if (((_a = options.element) === null || _a === void 0 ? void 0 : _a.value) != null) {\n                        (_d = (_c = (_b = options.element) === null || _b === void 0 ? void 0 : _b.value) === null || _c === void 0 ? void 0 : _c.getBoundingClientRectAsync()) === null || _d === void 0 ? void 0 : _d.then(res => {\n                            resolve();\n                        });\n                    }\n                    else {\n                        resolve();\n                    }\n                });\n            });\n        });\n    };\n    const getClassNames = (name) => {\n        return new Map([\n            ['enter', `l-${name}-enter l-${name}-enter-active ${enterClass} ${enterActiveClass}`],\n            ['enter-to', `l-${name}-enter-to l-${name}-enter-active ${enterToClass} ${enterActiveClass}`],\n            ['leave', `l-${name}-leave l-${name}-leave-active ${leaveClass} ${leaveActiveClass}`],\n            ['leave-to', `l-${name}-leave-to l-${name}-leave-active ${leaveToClass} ${leaveActiveClass}`]\n        ]);\n    };\n    const transitionQueue = ref([]);\n    const performTransition = (newStatus, eventName) => { return __awaiter(this, void 0, void 0, function* () {\n        var _a;\n        if (status == newStatus)\n            return;\n        transitionQueue.value.push(newStatus);\n        if (isTransitioning)\n            return;\n        isTransitioning = true;\n        // 防止因结束 又切换为开始导致闪烁\n        isTransitionEnd = true;\n        while (transitionQueue.value.length > 0) {\n            const currentStatus = transitionQueue.value.shift();\n            status = currentStatus;\n            emitEvent(`before-${eventName}`);\n            yield sleep();\n            yield sleep();\n            if (status != currentStatus)\n                continue;\n            const classNames = getClassNames(name.value);\n            inited.value = true;\n            display.value = true;\n            classes.value = classNames.get(eventName);\n            emitEvent(eventName);\n            const executeAfterTick = (_a = options.onNextTick) === null || _a === void 0 ? void 0 : _a.call(options, eventName);\n            if (executeAfterTick != null) {\n                yield executeAfterTick;\n            }\n            yield sleep();\n            if (status != currentStatus)\n                continue;\n            classes.value = classNames.get(`${eventName}-to`);\n            // isTransitionEnd = false;\n            // 防止最后无法关闭\n            if (status == 'leave') {\n                setTimeout(() => {\n                    finished();\n                }, duration);\n            }\n        }\n        // 不延迟 会导致快速切换时 因display none 闪烁\n        clearTimeout(timeoutId);\n        timeoutId = setTimeout(() => {\n            if (transitionQueue.value.length == 0 && status == newStatus) {\n                isTransitionEnd = false;\n            }\n        }, duration * 0.8);\n        isTransitioning = false;\n    }); };\n    // 定义进入过渡的函数\n    const enter = () => {\n        performTransition('enter', 'enter');\n    };\n    const leave = () => {\n        performTransition('leave', 'leave');\n    };\n    let init = false;\n    watchEffect(() => {\n        if (options.visible == null)\n            return;\n        state.value = options.visible();\n        if (!appear && !init) {\n            init = true;\n            return;\n        }\n        if (state.value) {\n            enter();\n        }\n        else {\n            leave();\n        }\n    });\n    watchEffect(() => {\n        if (options.name == null)\n            return;\n        name.value = options.name();\n    });\n    const toggle = (v) => {\n        state.value = v;\n        if (v) {\n            enter();\n        }\n        else {\n            leave();\n        }\n    };\n    return {\n        state,\n        inited,\n        display,\n        classes,\n        name,\n        finished,\n        toggle\n    };\n}\n//# sourceMappingURL=/Users/xyhc/Documents/veepai_uniappx/uni_modules/lime-transition/index.js.map","references":["/Users/xyhc/Documents/veepai_uniappx/uni_modules/lime-shared/raf/index.ts"],"uniExtApis":[],"map":"{\"version\":3,\"file\":\"index.js\",\"sourceRoot\":\"\",\"sources\":[\"index.ts\"],\"names\":[],\"mappings\":\"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\"}"}
