{"code":"import { __awaiter } from \"tslib\";\nimport { defineComponent as _defineComponent } from 'vue';\nimport { ref, computed, onMounted } from 'vue';\nimport { calculateTimeline, calculateWavePosition } from \"@/uts/timelineEngine\";\n// 视频状态\nexport default /*#__PURE__*/ _defineComponent({\n    __name: 'deviceReplay',\n    setup(__props, _a) {\n        var __expose = _a.expose;\n        __expose();\n        const videoContext = ref(null);\n        const videoUrl = ref('');\n        const currentTime = ref(0);\n        const duration = ref(86400);\n        // 时间轴状态\n        const timelineWidth = ref(86400); // 24小时默认宽度\n        const scrollPosition = ref(0);\n        const visibleRange = ref(new UTSJSONObject({ start: 0, end: 7200 })); // 默认显示2小时\n        const markDensity = ref(5); // 5分钟间隔\n        // 日期控制\n        const currentDate = ref(new Date());\n        const formattedDate = computed(() => {\n            const d = currentDate.value;\n            return `${d.getFullYear()}-${(d.getMonth() + 1).toString().padStart(2, '0')}-${d.getDate().toString().padStart(2, '0')}`;\n        });\n        // 事件数据\n        const eventMarkers = ref([]);\n        // 初始化\n        onMounted(() => {\n            videoContext.value = uni.createVideoContext('mainVideo');\n            loadVideoData();\n        });\n        // 加载视频数据\n        const loadVideoData = () => { return __awaiter(this, void 0, void 0, function* () {\n            try {\n                const res = yield uni.request({\n                    // url: `https://your-api.com/videos?date=${formattedDate.value}`\n                    url: 'https://qiniu-web-assets.dcloud.net.cn/video/sample/2minute-demo.mp4'\n                });\n                videoUrl.value = res.data.url;\n                duration.value = res.data.duration || 86400;\n                eventMarkers.value = res.data.events || [];\n                timelineWidth.value = duration.value > 86400 ? duration.value : 86400;\n            }\n            catch (error) {\n                uni.showToast({ title: '加载失败', icon: 'none' });\n            }\n        }); };\n        // 计算可见标记\n        const visibleMarks = computed(() => {\n            return calculateTimeline({\n                duration: duration.value,\n                width: timelineWidth.value,\n                density: markDensity.value,\n                events: eventMarkers.value,\n                visibleRange: visibleRange.value\n            });\n        });\n        // 标记样式计算\n        const getMarkStyle = (mark = null) => {\n            const baseStyle = new UTSJSONObject({\n                left: `${mark.position}px`\n            });\n            if (mark.hasEvent) {\n                return new UTSJSONObject(Object.assign(Object.assign({}, baseStyle), { top: `${calculateWavePosition(mark.timestamp, currentTime.value)}px` }));\n            }\n            return baseStyle;\n        };\n        // 当前播放位置\n        const currentPosition = computed(() => {\n            return (currentTime.value / duration.value) * timelineWidth.value;\n        });\n        // 时间更新处理\n        const handleTimeUpdate = (e = null) => {\n            currentTime.value = e.detail.currentTime;\n            updateScrollPosition();\n        };\n        // 更新滚动位置\n        const updateScrollPosition = () => {\n            const viewportWidth = 750; // 小程序基准宽度\n            scrollPosition.value = Math.max(0, currentPosition.value - viewportWidth / 2);\n        };\n        // 跳转到指定时间\n        const seekTo = (time = null) => {\n            videoContext.value.seek(time);\n            currentTime.value = time;\n        };\n        // 日期切换\n        const changeDate = (offset = null) => {\n            const newDate = new Date(currentDate.value);\n            newDate.setDate(newDate.getDate() + offset);\n            currentDate.value = newDate;\n            loadVideoData();\n        };\n        // 处理滚动\n        const handleScroll = (e = null) => {\n            scrollPosition.value = e.detail.scrollLeft;\n            updateVisibleRange();\n        };\n        // 更新可见范围\n        const updateVisibleRange = () => {\n            const ratio = scrollPosition.value / timelineWidth.value;\n            visibleRange.value = {\n                start: ratio * duration.value,\n                end: ratio * duration.value + 7200 // 保持2小时可见窗口\n            };\n        };\n        const __returned__ = { videoContext, videoUrl, currentTime, duration, timelineWidth, scrollPosition, visibleRange, markDensity, currentDate, formattedDate, eventMarkers, loadVideoData, visibleMarks, getMarkStyle, currentPosition, handleTimeUpdate, updateScrollPosition, seekTo, changeDate, handleScroll, updateVisibleRange };\n        Object.defineProperty(__returned__, '__isScriptSetup', { enumerable: false, value: true });\n        return __returned__;\n    }\n});\n//# sourceMappingURL=/Users/xyhc/Documents/veepai_uniappx/pages/index/deviceReplay.uvue?vue&type=script&setup=true&lang.uts.js.map","references":["/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts"],"uniExtApis":["uni.createVideoContext","uni.request","uni.showToast"],"map":"{\"version\":3,\"file\":\"deviceReplay.uvue?vue&type=script&setup=true&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"deviceReplay.uvue?vue&type=script&setup=true&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
